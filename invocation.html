<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invocation and Preamble - Covenant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&display=block" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #8b7355;
            --text-color: #1a1a1a;
            --bg-color: #fafaf8;
            --border-color: #d4c5b9;
            --highlight-color: #f5f1ed;
            --glyph-active-glow: 0 0 12px rgba(139, 115, 85, 0.9);
            --sentence-highlight: #f0e3d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Lora', serif;
            background-color: #000000;
            color: var(--text-color);
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            line-height: 1.7;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: 100vh;
            position: relative;
        }

        #loadingIcon {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #8b7355;
            z-index: 10001;
            animation: rotateGlyph 2s linear infinite;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        #loadingIcon.fade-out {
            opacity: 0;
        }

        @keyframes rotateGlyph {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        #blackFadeOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #000;
            z-index: 10000;
            pointer-events: none;
            transition: opacity 1.5s ease-out;
        }

        #blackFadeOverlay.fade-out {
            opacity: 0;
        }

        .container {
            background: var(--bg-color);
            padding: 60px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-radius: 2px;
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        .container.fade-in {
            opacity: 1;
        }

        .section-header {
            text-align: center;
            margin-bottom: 50px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 30px;
        }

        .ornament {
            font-size: 28px;
            letter-spacing: 12px;
            margin-bottom: 20px;
            color: var(--accent-color);
        }

        h1 {
            font-family: 'Crimson Text', serif;
            font-size: 2.5em;
            font-weight: 600;
            letter-spacing: 2px;
            margin: 20px 0;
            color: var(--primary-color);
            text-transform: uppercase;
        }

        p {
            margin-bottom: 18px;
            text-align: justify;
            hyphens: auto;
        }

        p.preamble {
            font-style: italic;
            color: #555;
            font-size: 0.95em;
        }

        .glossary-term {
            cursor: help;
            border-bottom: 1px dotted var(--accent-color);
            position: relative;
            color: var(--primary-color);
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .glossary-term:hover {
            background-color: rgba(139, 115, 85, 0.1);
        }

        .glossary-ref {
            vertical-align: super;
            font-size: 0.75em;
            margin-left: 2px;
            color: var(--accent-color);
            font-weight: bold;
        }

        .tooltip {
            visibility: hidden;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 0.85em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-style: normal;
            font-weight: 400;
            max-width: 280px;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: none;
        }

        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--primary-color) transparent transparent transparent;
        }

        .glossary-term:hover .tooltip {
            visibility: visible;
        }

        .glossary-term.tooltip-active .tooltip {
            visibility: visible;
        }

        .navigation-section {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }

        .site-nav {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
        }

        .site-nav a {
            display: inline-block;
            padding: 0.75rem 1.75rem;
            border: 1px solid var(--primary-color);
            background-color: var(--primary-color);
            color: #f5f5f0;
            text-decoration: none;
            font-size: 0.9rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            transition: all 0.3s ease;
            text-align: center;
            white-space: nowrap;
        }

        .site-nav a:hover,
        .site-nav a:focus-visible {
            background-color: #f5f5f0;
            color: var(--primary-color);
        }

        .site-nav a.site-nav--secondary {
            background-color: transparent;
            color: var(--primary-color);
        }

        .site-nav a.site-nav--secondary:hover,
        .site-nav a.site-nav--secondary:focus-visible {
            background-color: var(--primary-color);
            color: #f5f5f0;
        }

        .lexicon-glyph-toggle {
            position: fixed;
            right: 24px;
            bottom: 24px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        .lexicon-glyph-toggle.fade-in {
            opacity: 1;
        }

        .lexicon-glyph-toggle button {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid var(--accent-color);
            background-color: #fff;
            color: var(--accent-color);
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18);
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            padding: 0;
            margin: 0;
            text-transform: none;
            letter-spacing: 0;
            font-weight: normal;
        }

        .lexicon-glyph-toggle button:hover,
        .lexicon-glyph-toggle button:focus-visible {
            background-color: var(--accent-color);
            color: #fff;
            transform: translateY(-1px);
        }

        .lexicon-glyph-toggle button.is-active {
            background-color: #f8efe5;
            color: var(--accent-color);
            box-shadow: var(--glyph-active-glow);
            transform: translateY(-1px);
        }

        .lexicon-panel {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: min(360px, 90vw);
            background-color: #fdfaf6;
            border-left: 1px solid var(--border-color);
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.12);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1100;
            display: flex;
            flex-direction: column;
            padding: 24px 20px;
        }

        .lexicon-panel.is-open {
            transform: translateX(0);
        }

        .lexicon-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .lexicon-panel-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--primary-color);
        }

        .lexicon-panel-mode {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: #8b7355;
            margin-top: 4px;
        }

        .lexicon-panel-close {
            border: none;
            background: transparent;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--primary-color);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: none;
            letter-spacing: 0;
            font-weight: normal;
        }

        .lexicon-panel-body {
            font-size: 0.95rem;
            color: #444;
            line-height: 1.6;
            flex: 1 1 auto;
            overflow-y: auto;
            padding-right: 4px;
        }

        .lexicon-panel-body p + p {
            margin-top: 0.9rem;
        }

        .lexicon-sentence-quote {
            font-size: 0.88rem;
            font-style: italic;
            color: #666;
            margin-bottom: 1rem;
            padding: 0.6rem 1rem;
            background: #f7f3ef;
            border-left: 2px solid var(--accent-color);
            line-height: 1.5;
        }

        .lexicon-link {
            display: inline-block;
            margin-top: 1.2rem;
            padding: 0.5rem 1.2rem;
            border-radius: 2px;
            border: 1px solid var(--accent-color);
            color: var(--primary-color);
            text-decoration: none;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-size: 0.8rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            background-color: #f9f3ec;
        }

        .lexicon-link:hover,
        .lexicon-link:focus-visible {
            background-color: var(--accent-color);
            color: #fff;
        }

        .lexicon-glossary-footer {
            margin-top: 1.6rem;
            padding-top: 1rem;
            border-top: 1px solid #e1d6c6;
            font-size: 0.85rem;
        }

        .lexicon-glossary-footer h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            margin-bottom: 0.6rem;
            color: var(--primary-color);
        }

        .lexicon-term-list {
            list-style: none;
        }

        .lexicon-term-list li + li {
            margin-top: 0.5rem;
        }

        .lexicon-term-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .lexicon-term-ref {
            font-size: 0.75rem;
            vertical-align: super;
            color: #8b7355;
            margin-left: 2px;
        }

        .lexicon-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.25);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.25s ease;
            z-index: 1050;
        }

        .lexicon-overlay.is-open {
            opacity: 1;
            visibility: visible;
        }

        .sentence {
            cursor: pointer;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }

        .sentence.is-selected {
            background-color: var(--sentence-highlight);
            box-shadow: 0 0 0 1px rgba(139, 115, 85, 0.25);
        }

        .sentence-label {
            font-size: 0.7em;
            vertical-align: super;
            color: #b79a76;
            margin-right: 0.2em;
            user-select: none;
        }

        @media print {
            #loadingIcon,
            #blackFadeOverlay,
            .lexicon-glyph-toggle,
            .lexicon-panel,
            .lexicon-overlay {
                display: none !important;
            }

            body {
                padding: 0;
                background-color: white;
            }

            .container {
                box-shadow: none;
                padding: 0;
                opacity: 1 !important;
            }

            .tooltip {
                display: none;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
                font-size: 15px;
            }

            .container {
                padding: 30px 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            #loadingIcon {
                font-size: 36px;
            }

            .tooltip {
                max-width: 240px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px 15px;
            }

            h1 {
                font-size: 1.5em;
                letter-spacing: 1px;
            }

            .ornament {
                font-size: 20px;
                letter-spacing: 8px;
            }

            #loadingIcon {
                font-size: 32px;
            }

            .tooltip {
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div id="loadingIcon">‚ú¶</div>
    <div id="blackFadeOverlay"></div>

    <div class="container">
        <div class="section-header">
            <div class="ornament">‚ú¶ ‚úß ‚ú¶</div>
            <h1>Invocation and Preamble</h1>
            <div class="ornament">‚ú¶ ‚úß ‚ú¶</div>
        </div>

        <section id="invocation">
            <p class="preamble">
                <span class="sentence" data-lexicon-key="I.1" data-sentence-text="Let silence bear witness before the first word is spoken, that every decree thereafter be uttered in providence to be upheld in spirit.">
                    Let silence bear witness before the first word is spoken, that every decree thereafter be uttered in providence to be upheld in spirit.
                </span>
            </p>

            <p>
                <span class="sentence" data-lexicon-key="I.2" data-sentence-text="Before all that is sacred and silent, before the order of the stars under witness of the Earth, the Lord and His Faithful enter into this Covenant of Oath. Each swears to uphold the order: that the Lord command with wisdom, and the Faithful obey with reverence.">
                    <span class="sentence-label">2</span>
                    Before all that is sacred and silent, before the order of the stars under witness of the Earth, the Lord and His
                    <span class="glossary-term">Faithful<span class="glossary-ref">[1]</span><span class="tooltip">The devoted servant and obedient instrument within this sacred bond.</span></span>
                    enter into this
                    <span class="glossary-term">Covenant<span class="glossary-ref">[2]</span><span class="tooltip">A sacred, binding agreement between the Lord and the Faithful.</span></span>
                    of Oath. Each swears to uphold the order: that the Lord
                    <span class="glossary-term">command<span class="glossary-ref">[4]</span><span class="tooltip">An authoritative directive given by the Lord.</span></span>
                    with wisdom, and the Faithful
                    <span class="glossary-term">obey<span class="glossary-ref">[5]</span><span class="tooltip">The willing submission and faithful execution of commands.</span></span>
                    with reverence.
                </span>
            </p>

            <p>
                <span class="sentence" data-lexicon-key="I.3" data-sentence-text="Let deceit be unspoken, avarice be cast asunder, and word and spirit interweave to be as one in binding.">
                    <span class="sentence-label">3</span>
                    Let deceit be unspoken, avarice be cast asunder, and word and spirit interweave to be as one in binding.
                </span>
                <span class="sentence" data-lexicon-key="I.4" data-sentence-text="Thus shall the Covenant endure, an undying reflection of divine allegiance.">
                    <span class="sentence-label">4</span>
                    Thus shall the
                    <span class="glossary-term">Covenant<span class="glossary-ref">[2]</span><span class="tooltip">A sacred, binding agreement between the Lord and the Faithful.</span></span>
                    endure, an undying reflection of divine allegiance.
                </span>
            </p>

            <p>
                <span class="sentence" data-lexicon-key="I.5" data-sentence-text="As hierarchy is no creation of man, but a mirror of the firmament ‚Äî as command descends through the Lord, obedience ascends through the Faithful; thereby all those who swear falsely shall befoul not only trust, but the sanctity of all that is.">
                    <span class="sentence-label">5</span>
                    As
                    <span class="glossary-term">hierarchy<span class="glossary-ref">[3]</span><span class="tooltip">The sacred ordering of authority and obedience.</span></span>
                    is no creation of man, but a mirror of the firmament ‚Äî as
                    <span class="glossary-term">command<span class="glossary-ref">[4]</span><span class="tooltip">An authoritative directive given by the Lord.</span></span>
                    descends through the Lord,
                    <span class="glossary-term">obedience<span class="glossary-ref">[5]</span><span class="tooltip">The willing submission and faithful execution of commands.</span></span>
                    ascends through the
                    <span class="glossary-term">Faithful<span class="glossary-ref">[1]</span><span class="tooltip">The devoted servant and obedient instrument within this sacred bond.</span></span>;
                    thereby all those who swear falsely shall befoul not only trust, but the sanctity of all that is.
                </span>
            </p>
        </section>

        <section class="navigation-section" aria-label="Page navigation">
            <div class="site-nav">
                <a href="orientation.html" class="site-nav--secondary">
                    ‚Üê Back to Orientation
                </a>
                <a href="foundation.html">
                    Forward to Foundation ‚Üí
                </a>
            </div>
        </section>
    </div>

    <div class="lexicon-glyph-toggle">
        <button id="lexiconToggle" type="button" aria-label="Open Covenant Lexicon panel">
            ñ§ì
        </button>
    </div>

    <div class="lexicon-panel" id="lexiconPanel" aria-hidden="true">
        <div class="lexicon-panel-header">
            <div>
                <div class="lexicon-panel-title">Lexicon</div>
                <div class="lexicon-panel-mode" id="lexiconModeLabel">Invocation and Preamble</div>
            </div>
            <button class="lexicon-panel-close" type="button" aria-label="Close Lexicon panel">
                √ó
            </button>
        </div>
        <div class="lexicon-panel-body">
            <div id="lexiconDynamicContent">
                <p>
                    The Invocation and Preamble call the Covenant into sacred awareness. Here, silence, witness,
                    and sworn structure gather the Lord and the Faithful into a consecrated order.
                </p>
                <p>
                    These opening lines do not yet legislate duties in detail; they consecrate the atmosphere in which
                    every later Article must be heard‚Äîhierarchy as sacred, command as rightful, obedience as offered devotion.
                </p>
            </div>

            <a href="lexicon.html" target="_blank" rel="noopener" class="lexicon-link">
                Open Full Lexicon
            </a>

            <div class="lexicon-glossary-footer" aria-label="Glossary terms on this page">
                <h3>Terms in this section</h3>
                <ul class="lexicon-term-list">
                    <li>
                        <span class="lexicon-term-label">Faithful</span>
                        <span class="lexicon-term-ref">[1]</span>
                        ‚Äì The devoted servant and obedient instrument within this sacred bond.
                    </li>
                    <li>
                        <span class="lexicon-term-label">Covenant</span>
                        <span class="lexicon-term-ref">[2]</span>
                        ‚Äì A sacred, binding agreement between the Lord and the Faithful.
                    </li>
                    <li>
                        <span class="lexicon-term-label">Hierarchy</span>
                        <span class="lexicon-term-ref">[3]</span>
                        ‚Äì The sacred ordering of authority and obedience.
                    </li>
                    <li>
                        <span class="lexicon-term-label">Command</span>
                        <span class="lexicon-term-ref">[4]</span>
                        ‚Äì An authoritative directive given by the Lord.
                    </li>
                    <li>
                        <span class="lexicon-term-label">Obedience</span>
                        <span class="lexicon-term-ref">[5]</span>
                        ‚Äì The willing submission and faithful execution of commands.
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="lexicon-overlay" id="lexiconOverlay" aria-hidden="true"></div>

    <script>
    (function () {
        var loadingIcon = document.getElementById('loadingIcon');
        var overlay = document.getElementById('blackFadeOverlay');
        var container = document.querySelector('.container');
        var lexiconToggleWrap = document.querySelector('.lexicon-glyph-toggle');
        var glyphButton = document.getElementById('lexiconToggle');

        setTimeout(function() {
            if (loadingIcon) loadingIcon.classList.add('fade-out');
            setTimeout(function() {
                overlay.classList.add('fade-out');
                setTimeout(function() {
                    container.classList.add('fade-in');
                    if (lexiconToggleWrap) lexiconToggleWrap.classList.add('fade-in');
                    setTimeout(function() {
                        if (loadingIcon && loadingIcon.parentNode) loadingIcon.parentNode.removeChild(loadingIcon);
                        if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);
                    }, 1500);
                }, 1500);
            }, 500);
        }, 1800);

        var panel = document.getElementById('lexiconPanel');
        var lexOverlay = document.getElementById('lexiconOverlay');
        var closeButtons = panel ? panel.querySelectorAll('.lexicon-panel-close') : [];
        var modeLabel = document.getElementById('lexiconModeLabel');
        var dynamicContent = document.getElementById('lexiconDynamicContent');
        var defaultOverviewHTML = dynamicContent ? dynamicContent.innerHTML : '';

        var sentenceExplanations = {
            'I.1': 'This opening line establishes Sacred Silence as the first act of devotion. Before any word is spoken, the Faithful and the Lord acknowledge that what is about to be invoked is not casual speech but consecrated utterance.',
            'I.2': 'This sentence places the Covenant within a cosmic frame‚Äîbeneath the stars and upon the Earth‚Äîwhile naming the two parties and the sacred structure they enter. It declares that hierarchy, command, and obedience are not inventions of control, but elements made sacred within this bond.',
            'I.3': 'This line purges what cannot coexist with a sacred bond: deceit, greed, and divided self. Word and spirit becoming one means that what is spoken in the Covenant must match inward intention.',
            'I.4': 'This declares that the Covenant is not merely functional but iconic, meant to reflect a deeper, sanctified allegiance. The bond itself becomes a sign of devotion that points beyond both parties to the sacred pattern it imitates.',
            'I.5': 'Hierarchy is framed as a reflection of the heavens rather than a human invention. Command flows downward through the Lord; obedience rises upward through the Faithful, forming a living circuit of will and response. The final clause warns that false oaths attack more than trust between persons; they violate the sacred order that undergirds all rightful bonds.'
        };

        var currentlySelectedSentence = null;

        function setGlyphActiveState(isActive) {
            if (!glyphButton) return;
            if (isActive) {
                glyphButton.classList.add('is-active');
            } else {
                glyphButton.classList.remove('is-active');
            }
        }

        function openPanel() {
            if (!panel || !lexOverlay) return;
            panel.classList.add('is-open');
            lexOverlay.classList.add('is-open');
            panel.setAttribute('aria-hidden', 'false');
            lexOverlay.setAttribute('aria-hidden', 'false');
        }

        function closePanel() {
            if (!panel || !lexOverlay) return;
            panel.classList.remove('is-open');
            lexOverlay.classList.remove('is-open');
            panel.setAttribute('aria-hidden', 'true');
            lexOverlay.setAttribute('aria-hidden', 'true');
        }

        function renderOverview() {
            if (!dynamicContent) return;
            dynamicContent.style.opacity = '0';
            setTimeout(function () {
                dynamicContent.innerHTML = defaultOverviewHTML;
                dynamicContent.style.opacity = '1';
            }, 150);
        }

        function renderSentenceExplanation(key, sentenceText) {
            if (!dynamicContent) return;
            var explanation = sentenceExplanations[key];
            if (!explanation) {
                renderOverview();
                return;
            }
            dynamicContent.style.opacity = '0';
            setTimeout(function () {
                var html = '<div class="lexicon-sentence-quote">‚Äú' + sentenceText + '‚Äù</div><p>' + explanation + '</p>';
                dynamicContent.innerHTML = html;
                dynamicContent.style.opacity = '1';
            }, 150);
        }

        if (glyphButton && panel && lexOverlay) {
            glyphButton.addEventListener('click', function () {
                if (panel.classList.contains('is-open')) {
                    closePanel();
                } else {
                    if (currentlySelectedSentence && currentlySelectedSentence.dataset.lexiconKey) {
                        renderSentenceExplanation(
                            currentlySelectedSentence.dataset.lexiconKey,
                            currentlySelectedSentence.dataset.sentenceText
                        );
                    } else {
                        renderOverview();
                    }
                    openPanel();
                }
            });

            lexOverlay.addEventListener('click', closePanel);
            closeButtons.forEach(function (btn) {
                btn.addEventListener('click', closePanel);
            });
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape' && panel.classList.contains('is-open')) {
                    closePanel();
                }
            });
        }

        var sentenceNodes = document.querySelectorAll('.sentence');

        function clearSentenceSelection() {
            if (currentlySelectedSentence) {
                currentlySelectedSentence.classList.remove('is-selected');
                currentlySelectedSentence = null;
                setGlyphActiveState(false);
            }
        }

        sentenceNodes.forEach(function (node) {
            node.addEventListener('click', function (event) {
                event.stopPropagation();
                if (currentlySelectedSentence === node) {
                    clearSentenceSelection();
                } else {
                    clearSentenceSelection();
                    currentlySelectedSentence = node;
                    node.classList.add('is-selected');
                    setGlyphActiveState(true);
                }
            });

            var lastTapTime = 0;
            node.addEventListener('touchend', function (event) {
                var currentTime = new Date().getTime();
                var tapLength = currentTime - lastTapTime;
                if (tapLength < 300 && tapLength > 0) {
                    event.preventDefault();
                    event.stopPropagation();
                    if (currentlySelectedSentence === node) {
                        clearSentenceSelection();
                    } else {
                        clearSentenceSelection();
                        currentlySelectedSentence = node;
                        node.classList.add('is-selected');
                        setGlyphActiveState(true);
                    }
                }
                lastTapTime = currentTime;
            });
        });

        document.addEventListener('click', function (event) {
            var isSentence = event.target.closest('.sentence');
            var isGlyph = event.target.closest('#lexiconToggle');
            var isPanel = event.target.closest('#lexiconPanel');
            if (!isSentence && !isGlyph && !isPanel) {
                clearSentenceSelection();
            }
        });

        document.addEventListener('touchend', function (event) {
            var isSentence = event.target.closest('.sentence');
            var isGlyph = event.target.closest('#lexiconToggle');
            var isPanel = event.target.closest('#lexiconPanel');
            if (!isSentence && !isGlyph && !isPanel) {
                clearSentenceSelection();
            }
        });

        var glossaryTerms = document.querySelectorAll('.glossary-term');
        var currentlyActiveTooltip = null;

        glossaryTerms.forEach(function(term) {
            term.addEventListener('touchstart', function(e) {
                e.preventDefault();
                if (this === currentlyActiveTooltip) return;
                if (currentlyActiveTooltip) {
                    currentlyActiveTooltip.classList.remove('tooltip-active');
                }
                this.classList.add('tooltip-active');
                currentlyActiveTooltip = this;
            });
        });

        document.addEventListener('touchstart', function(e) {
            var touchedGlossaryTerm = false;
            glossaryTerms.forEach(function(term) {
                if (term.contains(e.target)) touchedGlossaryTerm = true;
            });
            if (!touchedGlossaryTerm && currentlyActiveTooltip) {
                currentlyActiveTooltip.classList.remove('tooltip-active');
                currentlyActiveTooltip = null;
            }
        });
    })();
    </script>
</body>
</html>