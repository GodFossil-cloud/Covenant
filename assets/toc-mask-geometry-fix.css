/* Dock mask geometry fix (motion states only)
   - Restores a true semicircle cutout (no sharp side vertices) by using a fixed radius.
   - Lowers the cutout slightly (bottom edge was riding too high).
   - Restores a full-width top hairline during motion (the brass line), without reintroducing the darker border/inset sliver.
   - Restores the darker border-top during motion too, but leaves a gap over the cutout notch.

   Scope: only affects toc-opening/toc-closing and reliquary-opening/reliquary-closing.
*/

html.toc-opening,
html.toc-closing,
html.reliquary-opening,
html.reliquary-closing{
  /* Keep the window box close to the socket geometry; the circle radius below defines the actual cut. */
  --dock-window-h:calc(var(--dock-socket-h) + 2px);

  /* Lower the cutout a touch more. */
  --dock-window-y-shift:-2px;
}

/* The full-width sliver was coming from the base footer chrome (border-top and/or 1px inset highlight).
   While the dock window is active, keep the slab's own top edge suppressed. */
html.toc-opening .nav-footer,
html.toc-closing .nav-footer,
html.reliquary-opening .nav-footer,
html.reliquary-closing .nav-footer{
  border-top:0;

  /* Keep depth, but drop the top inset that reads like a 1px line. */
  box-shadow:
    0 -14px 22px -14px rgba(0,0,0,0.78),
    inset 0 -10px 18px -16px rgba(0,0,0,0.72);
}

/* During motion the footer slab is repainted on ::before so it can be mask-subtracted.
   - Brass hairline: full width.
   - Dark border-top: full width EXCEPT over the cutout notch.
*/
html.toc-opening .nav-footer::before,
html.toc-closing .nav-footer::before,
html.reliquary-opening .nav-footer::before,
html.reliquary-closing .nav-footer::before{
  background-image:
    /* Brass hairline (full width). */
    linear-gradient(to bottom,
      var(--footer-hairline) 0,
      var(--footer-hairline) 1px,
      rgba(0,0,0,0) 1px),

    /* Dark border-top (left of notch). */
    linear-gradient(to bottom,
      rgba(0,0,0,0.70) 0,
      rgba(0,0,0,0.70) 1px,
      rgba(0,0,0,0) 1px),

    /* Dark border-top (right of notch). */
    linear-gradient(to bottom,
      rgba(0,0,0,0.70) 0,
      rgba(0,0,0,0.70) 1px,
      rgba(0,0,0,0) 1px),

    /* Subtle top glow. */
    radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),

    /* Obsidian slab. */
    linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%);

  background-size:
    100% 1px,
    calc(var(--dock-window-left)) 1px,
    calc(100% - (var(--dock-window-left) + var(--dock-window-w))) 1px,
    100% 100%,
    100% 100%;

  background-position:
    0 0,
    0 0,
    calc(var(--dock-window-left) + var(--dock-window-w)) 0,
    50% 0,
    0 0;

  background-repeat:no-repeat;
}

@supports (-webkit-mask-image: linear-gradient(#000 0 0)){
  html.toc-opening .nav-footer::before,
  html.toc-opening .nav-footer::after,
  html.toc-closing .nav-footer::before,
  html.toc-closing .nav-footer::after,
  html.reliquary-opening .nav-footer::before,
  html.reliquary-opening .nav-footer::after,
  html.reliquary-closing .nav-footer::before,
  html.reliquary-closing .nav-footer::after{
    -webkit-mask-image:
      linear-gradient(#000 0 0),
      radial-gradient(circle var(--dock-socket-r) at 50% 0, #000 99%, transparent 100%);
  }
}

@supports (mask-image: linear-gradient(#000 0 0)){
  html.toc-opening .nav-footer::before,
  html.toc-opening .nav-footer::after,
  html.toc-closing .nav-footer::before,
  html.toc-closing .nav-footer::after,
  html.reliquary-opening .nav-footer::before,
  html.reliquary-opening .nav-footer::after,
  html.reliquary-closing .nav-footer::before,
  html.reliquary-closing .nav-footer::after{
    mask-image:
      linear-gradient(#000 0 0),
      radial-gradient(circle var(--dock-socket-r) at 50% 0, #000 99%, transparent 100%);
  }
}
