/* Dock mask geometry fix (motion states only)
   - Restores a true semicircle cutout (no sharp side vertices) by using a fixed radius.
   - Lowers the cutout slightly (bottom edge was riding too high).
   - Keeps footer chrome visually consistent at drag start (removes the perceived 1px "snap").
   - Keeps the footer's top-edge shadow present during drag; the panel can slide over it.
   - Keeps the faint dark top bar (border line) present during drag too, without drawing it across the cutout notch.

   Scope: only affects toc-opening/toc-closing and reliquary-opening/reliquary-closing.
*/

html.toc-opening,
html.toc-closing,
html.reliquary-opening,
html.reliquary-closing{
  /* Keep the window box close to the socket geometry; the circle radius below defines the actual cut. */
  --dock-window-h:calc(var(--dock-socket-h) + 2px);

  /* Lower the cutout a touch more. */
  --dock-window-y-shift:0px;
}

/* While the dock window is active, don't let the *base* footer chrome change (that reads as a 1px snap).
   Keep the slab's *outer* shadow on the base element (unmasked).

   Also keep the faint dark top bar on the base element so it doesn't vanish when masking begins.
   Draw it as two segments so the line does NOT cross the cutout notch.
*/
html.toc-opening .nav-footer,
html.toc-closing .nav-footer,
html.reliquary-opening .nav-footer,
html.reliquary-closing .nav-footer{
  border-top:0;

  box-shadow:0 -14px 22px -14px rgba(0,0,0,0.78);

  background-image:
    linear-gradient(to bottom,
      rgba(0,0,0,0.70) 0,
      rgba(0,0,0,0.70) 1px,
      rgba(0,0,0,0) 1px),
    linear-gradient(to bottom,
      rgba(0,0,0,0.70) 0,
      rgba(0,0,0,0.70) 1px,
      rgba(0,0,0,0) 1px);

  background-size:
    calc(var(--dock-window-left)) 1px,
    calc(100% - (var(--dock-window-left) + var(--dock-window-w))) 1px;

  background-position:
    0 0,
    calc(var(--dock-window-left) + var(--dock-window-w)) 0;

  background-repeat:no-repeat;
}

/* Motion repaint layer: match the normal footer slab surface.
   The notch mask subtracts this layer, so brass hairline / surface shading vanish only *over the cutout*.
   IMPORTANT: do not include the outer shadow here (masked shadows can clip/vanish).
   IMPORTANT: do not include the dark top border line here (it's handled on the base footer for stability).
*/
html.toc-opening .nav-footer::before,
html.toc-closing .nav-footer::before,
html.reliquary-opening .nav-footer::before,
html.reliquary-closing .nav-footer::before{
  border-top:0;
  border-bottom:1px solid rgba(0,0,0,0.92);

  /* Inset depth only (outer shadow lives on .nav-footer). */
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.04),
    inset 0 -10px 18px -16px rgba(0,0,0,0.72);

  background-image:
    /* Brass hairline (full width; will also be cut away at the notch). */
    linear-gradient(to bottom,
      var(--footer-hairline) 0,
      var(--footer-hairline) 1px,
      rgba(0,0,0,0) 1px),

    /* Subtle top glow. */
    radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),

    /* Obsidian slab. */
    linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%);

  background-size:
    100% 1px,
    100% 100%,
    100% 100%;

  background-position:
    0 0,
    50% 0,
    0 0;

  background-repeat:no-repeat;
}

@supports (-webkit-mask-image: linear-gradient(#000 0 0)){
  html.toc-opening .nav-footer::before,
  html.toc-opening .nav-footer::after,
  html.toc-closing .nav-footer::before,
  html.toc-closing .nav-footer::after,
  html.reliquary-opening .nav-footer::before,
  html.reliquary-opening .nav-footer::after,
  html.reliquary-closing .nav-footer::before,
  html.reliquary-closing .nav-footer::after{
    -webkit-mask-image:
      linear-gradient(#000 0 0),
      radial-gradient(circle var(--dock-socket-r) at 50% 0, #000 99%, transparent 100%);
    -webkit-mask-size:
      100% 100%,
      var(--dock-window-w) var(--dock-window-h);
    -webkit-mask-position:
      0 0,
      var(--dock-window-left) var(--dock-window-top);
    -webkit-mask-repeat:no-repeat;
    -webkit-mask-composite:destination-out;
  }
}

@supports (mask-image: linear-gradient(#000 0 0)){
  html.toc-opening .nav-footer::before,
  html.toc-opening .nav-footer::after,
  html.toc-closing .nav-footer::before,
  html.toc-closing .nav-footer::after,
  html.reliquary-opening .nav-footer::before,
  html.reliquary-opening .nav-footer::after,
  html.reliquary-closing .nav-footer::before,
  html.reliquary-closing .nav-footer::after{
    mask-image:
      linear-gradient(#000 0 0),
      radial-gradient(circle var(--dock-socket-r) at 50% 0, #000 99%, transparent 100%);
    mask-size:
      100% 100%,
      var(--dock-window-w) var(--dock-window-h);
    mask-position:
      0 0,
      var(--dock-window-left) var(--dock-window-top);
    mask-repeat:no-repeat;
    mask-composite:subtract;
  }
}
