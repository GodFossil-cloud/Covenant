/* Lexicon seal cover rules (ui-stack + translucency fix).

   Context:
   - assets/ui-stack.js assigns z-index to modal surfaces starting at Z_BASE=1500.
   - The footer dock remains sovereign (higher z-index) and can visually sit above scrims.
   - When Lexicon is open and another surface (ToC/Reliquary) becomes topmost, ui-stack.js
     toggles `.is-ui-stack-covered` on #lexiconToggle.

   Important update (Option B):
   - The seal may be re-parented into the Lexicon panel header while the panel is open.
     Therefore, cover rules MUST NOT depend on #navFooter ancestry.

   Why hide (not just z-index):
   - ToC/Reliquary overlays are intentionally translucent.
     If the seal is merely "behind" them, it can still be visible through the veil.

   Behavior:
   - When covered, the seal slides upward out of the viewport (and fades), then flips to
     visibility:hidden so it cannot read through veils at rest.
   - When uncovered, visibility returns immediately and the seal slides back into place.

   Implementation note:
   - Do NOT animate transform here: the dock seal already uses transform for drag math
     (lexicon.js drives --seal-drag-y, and footer-overrides.css applies translate3d).
   - Animate `top` instead; relative positioning composes cleanly with the existing transform.

   Mobile Safari gotcha:
   - assets/covenant.css sets a max-width:600px rule for #lexiconToggle that overwrites
     `transition` (it only animates transform + color/text/filter).
   - Therefore, we set our transition list with !important so top/opacity animate reliably.
*/

:root{
  --lexicon-cover-slide-ms:260ms;
  --lexicon-cover-fade-ms:220ms;
  --lexicon-cover-ease:cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* Base: enable motion (safe both in dock and when re-parented into the Lexicon header). */
#lexiconToggle{
  position:relative;
  top:0;
  opacity:1;
  visibility:visible;

  /* Default: visibility changes apply immediately unless the covered state sets a delay. */
  --lexicon-cover-visibility-delay:0s;

  will-change:top, opacity;

  /* IMPORTANT: beat the max-width:600px #lexiconToggle transition in assets/covenant.css. */
  transition:
    /* Preserve existing interactive feel. */
    color 0.2s ease,
    text-shadow 0.2s ease,
    filter 0.2s ease,
    transform var(--lexicon-snap-duration, 420ms) var(--lexicon-snap-ease, cubic-bezier(0.22, 0.61, 0.36, 1)),

    /* Cover motion. */
    top var(--lexicon-cover-slide-ms) var(--lexicon-cover-ease),
    opacity var(--lexicon-cover-fade-ms) var(--lexicon-cover-ease),

    /* Hide after the slide completes (delay set by covered state). */
    visibility 0s linear var(--lexicon-cover-visibility-delay)
    !important;
}

/* Covered: move it fully out of the viewport so it cannot show through translucent veils. */
#lexiconToggle.is-ui-stack-covered{
  /* Backstop: keep below ui-stack surfaces (Z_BASE=1500). */
  z-index:1490 !important;

  /* Slide away + fade. */
  top:calc(-120vh) !important;
  opacity:0 !important;

  pointer-events:none !important;

  /* Delay the visibility flip until the slide completes. */
  --lexicon-cover-visibility-delay:var(--lexicon-cover-slide-ms);
  visibility:hidden !important;

  /* Avoid any accidental compositing artifacts. */
  filter:none !important;
}

/* Uncovered: ensure visibility is immediate so it can slide back in. */
#lexiconToggle:not(.is-ui-stack-covered){
  --lexicon-cover-visibility-delay:0s;
  visibility:visible !important;
}

@media (prefers-reduced-motion: reduce){
  #lexiconToggle{
    transition:none !important;
  }
  #lexiconToggle.is-ui-stack-covered{
    top:0 !important;
    opacity:0 !important;
    visibility:hidden !important;
  }
}
