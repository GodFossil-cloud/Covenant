/* Lexicon seal cover rules (ui-stack + translucency fix).

   Context:
   - assets/ui-stack.js assigns z-index to modal surfaces starting at Z_BASE=1500.
   - The footer dock remains sovereign (higher z-index) and can visually sit above scrims.
   - When Lexicon is open and another surface (ToC/Reliquary) becomes topmost, ui-stack.js
     toggles `.is-ui-stack-covered` on #lexiconToggle.

   Important update (Option B):
   - The seal may be re-parented into the Lexicon panel header while the panel is open.
     Therefore, cover rules MUST NOT depend on #navFooter ancestry.

   Why hide (not just z-index):
   - ToC/Reliquary overlays are intentionally translucent.
     If the seal is merely "behind" them, it can still be visible through the veil.

   Behavior:
   - When covered, the seal slides upward out of the viewport (and fades), then flips to
     visibility:hidden so it cannot read through veils at rest.
   - When uncovered, visibility returns immediately and the seal slides back into place.

   Implementation note:
   - Do NOT animate transform here: the dock seal already uses transform for drag math
     (lexicon.js drives --seal-drag-y, and footer-overrides.css applies translate3d).
   - Animate `top` instead; relative positioning composes cleanly with the existing transform.
*/

:root{
  --lexicon-cover-slide-ms:260ms;
  --lexicon-cover-fade-ms:220ms;
  --lexicon-cover-ease:cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* Base: enable motion (safe both in dock and when re-parented into the Lexicon header). */
#lexiconToggle{
  position:relative;
  top:0;
  opacity:1;
  visibility:visible;

  will-change:top, opacity;

  transition:
    top var(--lexicon-cover-slide-ms) var(--lexicon-cover-ease),
    opacity var(--lexicon-cover-fade-ms) var(--lexicon-cover-ease);
}

/* Covered: move it fully out of the viewport so it cannot show through translucent veils. */
#lexiconToggle.is-ui-stack-covered{
  /* Backstop: keep below ui-stack surfaces (Z_BASE=1500). */
  z-index:1490 !important;

  /* Slide away + fade. */
  top:calc(-120vh) !important;
  opacity:0 !important;

  pointer-events:none !important;

  /* After motion completes, remove from paint/hit-testing entirely. */
  visibility:hidden !important;
  transition:
    top var(--lexicon-cover-slide-ms) var(--lexicon-cover-ease),
    opacity var(--lexicon-cover-fade-ms) var(--lexicon-cover-ease),
    visibility 0s linear var(--lexicon-cover-slide-ms);

  /* Avoid any accidental compositing artifacts. */
  filter:none !important;
}

/* Uncovered: ensure visibility is immediate so it can slide back in. */
#lexiconToggle:not(.is-ui-stack-covered){
  visibility:visible !important;
}

@media (prefers-reduced-motion: reduce){
  #lexiconToggle{
    transition:none !important;
  }
  #lexiconToggle.is-ui-stack-covered{
    top:0 !important;
    opacity:0 !important;
    visibility:hidden !important;
  }
}
