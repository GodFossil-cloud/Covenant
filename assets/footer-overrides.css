/* Footer overrides (head-loaded)
   Purpose: keep footer geometry + tones stable on first paint (especially iPhone Safari).

   This file consolidates:
   - nav-footer-flat-top.css (Lexicon seal flat-top geometry + socket/cradle shaping)
   - footer-tones.css (small contrast/ink nudges for dock tabs + Lexicon seal)

   Scope:
   - Geometry rules target #navFooter to avoid bleed.
   - Tone variables are global (as before) because toc.css consumes them.
*/

/* -------------------------------------------------
   Tone nudges (subtle contrast tuning)
   ------------------------------------------------- */

:root{
  /* Dock tab medallion surface (used by ToC + Mirror caps via toc.css).
     Single source of truth: toc.css must not redeclare this token. */
  --dock-tab-face:#010103;

  /* Lexicon seal: closed/base surface tones (keep selection/leaf styling untouched). */
  --lexicon-seal-face:#08090b;
  --lexicon-seal-face-hover:#0a0b0e;

  /* Lexicon glyph (open state): keep the symbol itself brass-gold, but let the halo go bright. */
  --lexicon-glyph-open-color:var(--gold-1, rgba(242,220,154,0.98));
  --lexicon-glyph-open-shadow:
    0 0 10px rgba(255,255,255,0.62),
    0 0 22px rgba(255,255,255,0.26),
    0 0 40px rgba(242,220,154,0.16);

  /* Tap-open flash (bigger initial bloom) â€” keep glyph brass; expand the halo only. */
  --lexicon-glyph-tap-flash-shadow:
    0 0 12px rgba(255,255,255,0.92),
    0 0 28px rgba(255,255,255,0.55),
    0 0 54px rgba(255,255,255,0.22),
    0 0 70px rgba(242,220,154,0.14);

  /* Lexicon cradle (the upward-facing semicircle behind the seal): 1px taller. */
  --lexicon-cradle-h:calc(var(--seal-notch-height) + 0px);
}

/* Darken the Lexicon seal base (closed state) + make it a flat single tone (no gradient stack). */
#lexiconToggle.nav-btn.center:not(.has-selection)::after{background-color:var(--lexicon-seal-face);background-image:none !important}

/* Preserve interaction feedback while staying within the darker scheme. */
#lexiconToggle.nav-btn.center:not(.has-selection):hover::after,
#lexiconToggle.nav-btn.center:not(.has-selection):focus-visible::after{background-color:var(--lexicon-seal-face-hover);background-image:none !important}

/* Lexicon OPEN: seal must be frameless so it welds into the Lexicon header. */
html.lexicon-scroll-lock #navFooter #lexiconToggle.nav-btn.center::before,
#navFooter #lexiconToggle.nav-btn.center[aria-expanded="true"]::before{border:0 !important;box-shadow:none !important}

html.lexicon-scroll-lock #navFooter #lexiconToggle.nav-btn.center,
#navFooter #lexiconToggle.nav-btn.center[aria-expanded="true"]{box-shadow:none !important}

/* Lexicon tab: shrink glyph only (do not alter seal/cradle geometry). */
#navFooter #lexiconToggle .lexicon-glyph{font-size:0.90em !important}

/* Lexicon tab: "earned" radiance on the glyph itself.
   Default at-rest remains quiet; open + intent states stay luminous.
   (Keeps iOS Safari stable: no rim/border glow, only text-shadow on the glyph.) */
#navFooter #lexiconToggle .lexicon-glyph,
#navFooter #lexiconToggle .lexicon-glyph-mid-inner{text-shadow:none}

/* OPEN (and selection): brass-gold glyph with bright halo that persists while open. */
#navFooter #lexiconToggle[aria-expanded="true"] .lexicon-glyph,
#navFooter #lexiconToggle[aria-expanded="true"] .lexicon-glyph-mid-inner,
#navFooter #lexiconToggle.has-selection .lexicon-glyph,
#navFooter #lexiconToggle.has-selection .lexicon-glyph-mid-inner{
  color:var(--lexicon-glyph-open-color);
  text-shadow:var(--lexicon-glyph-open-shadow);
}

/* Tap-to-close: keep the same halo through the closing transition even after aria-expanded flips. */
#navFooter #lexiconToggle.is-tap-closing .lexicon-glyph,
#navFooter #lexiconToggle.is-tap-closing .lexicon-glyph-mid-inner{
  color:var(--lexicon-glyph-open-color);
  text-shadow:var(--lexicon-glyph-open-shadow);
}

@keyframes lexiconTapOpenFlash{
  0%{color:var(--lexicon-glyph-open-color);text-shadow:var(--lexicon-glyph-tap-flash-shadow)}
  65%{color:var(--lexicon-glyph-open-color);text-shadow:
    0 0 12px rgba(255,255,255,0.78),
    0 0 26px rgba(255,255,255,0.40),
    0 0 48px rgba(242,220,154,0.18)}
  100%{color:var(--lexicon-glyph-open-color);text-shadow:var(--lexicon-glyph-open-shadow)}
}

/* Tap-to-open: bigger first flash, then settle into the persistent open halo.
   (This class is set by lexicon.js only for tap/click, not for drag.) */
#navFooter #lexiconToggle.is-tap-opening .lexicon-glyph,
#navFooter #lexiconToggle.is-tap-opening .lexicon-glyph-mid-inner{
  animation:lexiconTapOpenFlash calc(var(--lexicon-snap-duration, 420ms) * 0.92) ease-out 1;
}

@media (prefers-reduced-motion: reduce){
  #navFooter #lexiconToggle.is-tap-opening .lexicon-glyph,
  #navFooter #lexiconToggle.is-tap-opening .lexicon-glyph-mid-inner{animation:none}
}

/* Intent + drag feedback: match the same brass-gold + bright halo used in the fully-open state.
   (This includes dragging open/closed, and the brief intent pulses.) */
#navFooter #lexiconToggle.is-nudging .lexicon-glyph,
#navFooter #lexiconToggle.is-pulsing .lexicon-glyph,
#navFooter #lexiconToggle.is-seal-dragging .lexicon-glyph,
#navFooter #lexiconToggle.is-nudging .lexicon-glyph-mid-inner,
#navFooter #lexiconToggle.is-pulsing .lexicon-glyph-mid-inner,
#navFooter #lexiconToggle.is-seal-dragging .lexicon-glyph-mid-inner{
  color:var(--lexicon-glyph-open-color);
  text-shadow:var(--lexicon-glyph-open-shadow);
}

/* Make the Lexicon seal cradle border/field 1px taller without touching socket geometry tokens. */
.nav-footer::after{height:var(--lexicon-cradle-h, var(--seal-notch-height))}

/* Touch/coarse pointer: neutralize any fallback hover tint that would re-lighten the seal. */
@media (hover: none), (pointer: coarse){
  #lexiconToggle:not(.has-selection):hover::after,
  #lexiconToggle:not(.has-selection):focus-visible::after{background-color:var(--lexicon-seal-face);background-image:none !important}
}

/* -------------------------------------------------
   Flat-top Lexicon seal geometry (footer-only)
   ------------------------------------------------- */

#navFooter{
  /* Seal seating: raise the flat-top seal so its top edge aligns with the footer slab top.
     IMPORTANT (iPhone Safari): navFooterCritical defines this token later in the DOM.
     Use !important so vertical positioning changes actually take effect. */
  --lexicon-seal-top-align:12px !important;

  /* Cradle seat (circle center y, relative to footer top): keep it tracking the seal seat.
     (If the seal drops, the cradle should follow so the geometry still reads welded.) */
  --seal-cradle-center-y:1px;

  /* Border trace (cradle dock rim). */
  --footer-cradle-line:#39332A;

  /* Legacy tokens still exist, but the cradle now uses --seal-cradle-center-y directly. */
  --seal-cradle-shift-y:0px;
  --seal-cradle-drop-y:var(--seal-cradle-center-y);

  /* Lexicon SEAL size.
     IMPORTANT: must beat the inline iPhone "navFooterCritical" safety-net (later in DOM). */
  --lexicon-seal-w:66px !important;
  --lexicon-seal-h:34px !important;

  /* ToC/Mirror: slightly larger + slightly more spread, without touching Prev/Next. */
  --toc-tab-gap:26px !important;
  --toc-tab-width:calc(var(--nav-pill-width) + 8px);

  /* Side sockets: nudge outward so the cradles sit directly beneath the medallions. */
  --dock-socket-spread:10px;

  /* Side sockets: widen the cradle so the medallions sit more comfortably inside. */
  --dock-socket-d:calc(var(--dock-tab-width) + 6px);

  /* Socket geometry: cradle dock size (independent of seal). */
  --lexicon-cradle-w:66px;

  /* Tighten the void a touch more (so "smaller" reads even with antialias). */
  --seal-notch-grow:1px;

  /* IMPORTANT (iPhone Safari): navFooterCritical defines these same tokens later in the DOM.
     Use !important so cradle geometry stays authoritative and responds to --lexicon-cradle-w changes. */
  --seal-notch-radius:calc(var(--lexicon-cradle-w) * 0.5 + var(--seal-notch-grow)) !important;
  --seal-notch-height:calc(var(--seal-notch-radius) + 6px) !important;

  /* Cradle depth: deepen the ellipse so the trace hugs the underside of the seal. */
  --seal-notch-radius-y:calc(var(--seal-notch-radius) + 1px) !important;

  /* Border trace should follow the deeper void; give the tracing element enough height to render fully. */
  --seal-notch-height-y:calc(var(--seal-notch-radius-y) + 6px) !important;

  /* Micro-nudges for glyph optical centering (mobile Safari). */
  --toc-glyph-nudge-x:0px;
  --mirror-glyph-nudge-x:0px;
  --toc-glyph-nudge-y:8px;
  --mirror-glyph-nudge-y:8px;

  /* Prev/Next frames: slightly larger than the ToC/Mirror pill size (all breakpoints). */
  --nav-wing-pill-w:calc(var(--nav-pill-width) + 10px);
  --nav-wing-pill-h:calc(var(--nav-pill-height) + 8px);

  /* iOS Safari: keep the dock pre-promoted as a stable layer (see assets/covenant.css + AGENT.md).
     Do not override transform here; only guard against "will-change" churn. */
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
  will-change:auto;
  isolation:isolate;
}

/* Widen the footer dock more so Prev/Next sit further from the center (all breakpoints). */
#navFooter .nav-footer-inner{
  max-width:1120px;
  padding:0 2px;
}

#navFooter::before,
#navFooter::after{-webkit-backface-visibility:hidden;backface-visibility:hidden;will-change:auto}

/* Cutout socket:
   Paint the slab on ::before, then punch the cradle notch out via a mask.
   This makes the cradle interior transparent (reads as a carved opening).
*/
#navFooter{background:radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%) !important;border-top:none !important;border-bottom:none !important;box-shadow:none !important}

#navFooter::before{
  content:'';
  position:absolute;
  inset:0;
  pointer-events:none;

  /* Same obsidian slab paint as assets/covenant.css (.nav-footer override block). */
  background:
    radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),
    linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%);

  background-position:0 0,0 0;

  /* Single top seam only (no second line beneath). */
  border-top:1px solid rgba(44,34,14,0.92);
  border-bottom:0;

  box-shadow:
    0 -14px 22px -14px rgba(0,0,0,0.78),
    inset 0 -10px 18px -16px rgba(0,0,0,0.72);

  /* Punch the cradle void (ellipse: wider + deeper).
     NOTE (iOS Safari): avoid half-pixel mask stops (can jitter by ~1px on reraster).
  */
  -webkit-mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% var(--seal-cradle-center-y, 0px),
    rgba(0,0,0,0) 0 98%,
    rgba(255,255,255,1) 99% 100%
  );
  mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% var(--seal-cradle-center-y, 0px),
    rgba(0,0,0,0) 0 98%,
    rgba(255,255,255,1) 99% 100%
  );
  -webkit-mask-repeat:no-repeat;
  mask-repeat:no-repeat;
  -webkit-mask-size:100% 100%;
  mask-size:100% 100%;
}

/* Cradle border + shaded recess (match ToC/Mirror socket family). */
#navFooter::after{
  content:'';
  position:absolute;
  left:0;
  right:0;
  top:var(--seal-cradle-center-y, 0px);
  height:var(--seal-notch-height-y, var(--seal-notch-height));
  pointer-events:none;

  /* Clip the shading to the cradle ellipse only (so no rectangular wash).
     IMPORTANT: keep the mask opaque far enough out that the border trace isn't clipped. */
  -webkit-mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% 0%,
    rgba(255,255,255,1) 0 99.7%,
    rgba(0,0,0,0) 99.85% 100%
  );
  mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% 0%,
    rgba(255,255,255,1) 0 99.7%,
    rgba(0,0,0,0) 99.85% 100%
  );
  -webkit-mask-repeat:no-repeat;
  mask-repeat:no-repeat;
  -webkit-mask-size:100% 100%;
  mask-size:100% 100%;

  background:
    /* Border trace (U-shape): MUST be topmost or the depth layers will cover it. */
    radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% 0%,
      transparent 0 calc(var(--seal-notch-radius) - 2px),
      var(--footer-cradle-line) calc(var(--seal-notch-radius) - 1px) calc(var(--seal-notch-radius) + 1px),
      transparent calc(var(--seal-notch-radius) + 2px) 100%
    ),
    /* Sidewall bevels (machining reads at the sides, not the top rim). */
    linear-gradient(to right,
      rgba(255,255,255,.08) 0%,
      rgba(255,255,255,0) 18%,
      rgba(255,255,255,0) 82%,
      rgba(0,0,0,.55) 100%),
    /* Depth body (darker toward the arc floor). */
    radial-gradient(circle farthest-side at 50% 0,
      rgba(0,0,0,.92) 0%,
      rgba(16,16,20,.96) 46%,
      rgba(0,0,0,.985) 100%);

  opacity:0.96;
}

#navFooter #lexiconToggle,
#navFooter #lexiconToggle::before,
#navFooter #lexiconToggle::after{border-radius:0 0 999px 999px !important}

#navFooter #lexiconToggle{
  overflow:hidden;
  margin-top:calc(-1 * var(--lexicon-seal-top-align) + 4px) !important;

  /* iPhone Safari: keep the seal on its own stable layer so the cradle border
     doesn't hitch a ride on first drag frame reraster. */
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
  will-change:transform;

  /* Preserve drag math (lexicon.js drives --seal-drag-y). */
  -webkit-transform:translate3d(0, calc(0 * var(--seal-rise) + var(--seal-drag-y, 0px) - var(--seal-seat-nudge) + 0px), 0) !important;
  transform:translate3d(0, calc(0 * var(--seal-rise) + var(--seal-drag-y, 0px) - var(--seal-seat-nudge) + 0px), 0) !important;

  width:var(--lexicon-seal-w);
  height:var(--lexicon-seal-h);
}

@media (max-width: 600px){
  #navFooter{--toc-tab-gap:12px !important}
}

#navFooter #lexiconToggle{flex:0 0 var(--lexicon-seal-w)}

/* Prev/Next: larger frames, remove brass border outline. */
#navFooter .nav-next-frame,
#navFooter .nav-prev-frame{
  width:var(--nav-wing-pill-w);
  height:var(--nav-wing-pill-h);
}

#navFooter .nav-next-frame,
#navFooter .nav-prev-frame,
#navFooter .nav-next-frame::before,
#navFooter .nav-prev-frame::before,
#navFooter .nav-next-frame::after,
#navFooter .nav-prev-frame::after{
  transition:
    box-shadow 180ms cubic-bezier(0.22, 0.61, 0.36, 1),
    transform 180ms cubic-bezier(0.22, 0.61, 0.36, 1),
    filter 180ms cubic-bezier(0.22, 0.61, 0.36, 1),
    background 220ms cubic-bezier(0.22, 0.61, 0.36, 1);
}

#navFooter .nav-next-frame::before,
#navFooter .nav-prev-frame::before{
  border:0 !important;
  box-shadow:
    inset 0 0 26px rgba(0, 0, 0, 0.96),
    inset 0 2px 12px rgba(0, 0, 0, 0.62),
    inset 0 1px 0 rgba(255, 255, 255, 0.05),
    0 0 0 1px rgba(0, 0, 0, 0.74);
}

/* Neutral-gray face (lighter) to emphasize inset depth. */
#navFooter .nav-next-frame::after,
#navFooter .nav-prev-frame::after{
  background:
    linear-gradient(to bottom, rgba(255,255,255,0.085) 0%, rgba(255,255,255,0) 18px),
    linear-gradient(to bottom, rgba(38,40,45,0.76) 0%, rgba(10,10,12,0.90) 100%);
}

/* When the reader reaches the bottom (latched by JS): warm the enabled Next button only. */
#navFooter.is-at-bottom a.nav-next .nav-next-frame::after{
  background:
    linear-gradient(to bottom, rgba(255,233,178,0.10) 0%, rgba(255,233,178,0) 18px),
    linear-gradient(to bottom, rgba(72,50,18,0.72) 0%, rgba(10,8,4,0.94) 100%);
}

/* Two-tap navigation arming glow (first tap arms; second tap navigates). */
#navFooter a.nav-prev.is-armed .nav-prev-frame,
#navFooter a.nav-next.is-armed .nav-next-frame{
  transform:translateY(-1px) scale(1.01);
}

#navFooter a.nav-prev.is-armed .nav-prev-frame::before,
#navFooter a.nav-next.is-armed .nav-next-frame::before{
  box-shadow:
    inset 0 0 26px rgba(0, 0, 0, 0.96),
    inset 0 2px 12px rgba(0, 0, 0, 0.62),
    inset 0 1px 0 rgba(255, 255, 255, 0.06),
    0 0 0 1px rgba(255, 255, 255, 0.16),
    0 0 18px rgba(255, 255, 255, 0.12);
}

#navFooter.is-at-bottom a.nav-next.is-armed .nav-next-frame::before{
  box-shadow:
    inset 0 0 26px rgba(0, 0, 0, 0.96),
    inset 0 2px 12px rgba(0, 0, 0, 0.62),
    inset 0 1px 0 rgba(255, 255, 255, 0.06),
    0 0 0 1px rgba(242, 220, 154, 0.26),
    0 0 22px rgba(218, 184, 86, 0.18);
}

/* Second tap (commit): animated feedback on pointer-down (so it reads even if navigation is immediate). */
#navFooter a.nav-prev.is-armed:active .nav-prev-frame,
#navFooter a.nav-next.is-armed:active .nav-next-frame{
  animation:navRadiantPulse var(--nav-pulse-duration, 520ms) ease-out 1;
  box-shadow:
    0 0 0 1px rgba(201, 169, 97, 0.26),
    0 0 18px rgba(201, 169, 97, 0.20),
    0 0 34px rgba(201, 169, 97, 0.12);
}

#navFooter a.nav-prev.is-armed:active .nav-prev-frame::before,
#navFooter a.nav-next.is-armed:active .nav-next-frame::before{
  box-shadow:
    inset 0 0 26px rgba(0, 0, 0, 0.96),
    inset 0 2px 12px rgba(0, 0, 0, 0.62),
    inset 0 1px 0 rgba(255, 255, 255, 0.06),
    0 0 0 1px rgba(201, 169, 97, 0.20),
    0 0 18px rgba(201, 169, 97, 0.16);
}

#navFooter a.nav-prev.is-armed:active .nav-prev-frame::after,
#navFooter a.nav-next.is-armed:active .nav-next-frame::after{
  background:
    linear-gradient(to bottom, rgba(255, 242, 210, 0.22) 0%, rgba(255, 242, 210, 0) 18px),
    linear-gradient(to bottom, rgba(72,50,18,0.36) 0%, rgba(10,8,4,0.92) 100%);
}

@media (prefers-reduced-motion: reduce){
  #navFooter a.nav-prev.is-armed:active .nav-prev-frame,
  #navFooter a.nav-next.is-armed:active .nav-next-frame{animation:none}
}

/* Glyph seat: lower the Prev/Next arrow glyph by ~1px without moving the frames. */
#navFooter .nav-next .nav-btn-icon--arrow,
#navFooter .nav-prev .nav-btn-icon--arrow{
  position:relative;
  top:2px;
}

/* Two-tap navigation arming glow (label beneath the button). */
#navFooter .nav-next-label,
#navFooter .nav-prev-label{
  transition:
    color 180ms cubic-bezier(0.22, 0.61, 0.36, 1),
    text-shadow 180ms cubic-bezier(0.22, 0.61, 0.36, 1),
    opacity 180ms cubic-bezier(0.22, 0.61, 0.36, 1);
}

#navFooter a.nav-prev.is-armed .nav-prev-label,
#navFooter a.nav-next.is-armed .nav-next-label{
  opacity:1;
  text-shadow:
    0 1px 1px rgba(0, 0, 0, 0.96),
    0 0 14px rgba(255, 255, 255, 0.18);
}

#navFooter.is-at-bottom a.nav-next.is-armed .nav-next-label{
  text-shadow:
    0 1px 1px rgba(0, 0, 0, 0.96),
    0 0 16px rgba(242, 220, 154, 0.22);
}

#navFooter .nav-next-frame .nav-btn-icon,
#navFooter .nav-prev-frame .nav-btn-icon{
  font-size:1.55rem;
}

/* Citation label: keep it present even when empty (altar-leading emphasis).
   NOTE: covenant.css intentionally sets .citation-label { pointer-events: none; }.
   Here we override that so the label can be tapped to copy. */
#navFooter .citation-label{
  margin-top:4px;
  min-height:18px;
  display:flex !important;
  align-items:center;
  justify-content:center;
  position:relative;
  visibility:visible !important;
  pointer-events:auto;
}
#navFooter .citation-label:empty{display:flex !important;visibility:visible !important}

#navFooter .citation-copy{
  display:inline-block;
  border:0;
  background:transparent;
  padding:0;
  margin:0;
  font:inherit;
  color:inherit;
  letter-spacing:inherit;
  text-transform:inherit;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  pointer-events:auto;
}

#navFooter .citation-copy:focus-visible{
  outline:1px solid rgba(212, 170, 78, 0.65);
  outline-offset:4px;
  border-radius:6px;
}

/* "Copied" momentarily replaces the citation text (JS swaps #citationText content).
   Style it as a faint pill so it reads cleanly against the dock gradient. */
#navFooter .citation-label.is-copied #citationText{
  display:inline-block;
  color:var(--citation-color, rgba(242, 220, 154, 0.96));
  text-shadow:
    0 1px 1px rgba(0, 0, 0, 0.96),
    0 0 12px rgba(242, 220, 154, 0.18);

  background:rgba(0, 0, 0, 0.58);
  border:1px solid rgba(242, 220, 154, 0.22);
  border-radius:999px;
  padding:2px 9px 3px;

  letter-spacing:0.14em;
  line-height:1.08;
}

@media (max-width: 600px){
  #navFooter .citation-label{margin-top:2px;min-height:16px}

  #navFooter .nav-next-label,
  #navFooter .nav-prev-label{font-size:0.78rem;letter-spacing:0.10em;opacity:0.86}
}

@media (max-width: 480px){
  #navFooter .nav-next-label,
  #navFooter .nav-prev-label{font-size:0.76rem;opacity:0.8}
}
