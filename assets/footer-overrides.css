/* Footer overrides (head-loaded)
   Purpose: keep footer geometry + tones stable on first paint (especially iPhone Safari).

   This file consolidates:
   - nav-footer-flat-top.css (Lexicon seal flat-top geometry + socket/cradle shaping)
   - footer-tones.css (small contrast/ink nudges for dock tabs + Lexicon seal)

   Scope:
   - Geometry rules target #navFooter to avoid bleed.
   - Tone variables are global (as before) because toc.css consumes them.
*/

/* -------------------------------------------------
   Tone nudges (subtle contrast tuning)
   ------------------------------------------------- */

:root{
  /* Dock tab medallion surface (used by ToC + Mirror caps via toc.css).
     Single source of truth: toc.css must not redeclare this token. */
  --dock-tab-face:#010103;

  /* Lexicon seal: closed/base surface tones (keep selection/leaf styling untouched). */
  --lexicon-seal-face:#08090b;
  --lexicon-seal-face-hover:#0a0b0e;

  /* Lexicon cradle (the upward-facing semicircle behind the seal): 1px taller. */
  --lexicon-cradle-h:calc(var(--seal-notch-height) + 0px);
}

/* Darken the Lexicon seal base (closed state). */
#lexiconToggle.nav-btn.center:not(.has-selection)::after{background-color:var(--lexicon-seal-face)}

/* Preserve interaction feedback while staying within the darker scheme. */
#lexiconToggle.nav-btn.center:not(.has-selection):hover::after,
#lexiconToggle.nav-btn.center:not(.has-selection):focus-visible::after{background-color:var(--lexicon-seal-face-hover)}

/* Make the Lexicon seal cradle border/field 1px taller without touching socket geometry tokens. */
.nav-footer::after{height:var(--lexicon-cradle-h, var(--seal-notch-height))}

/* Touch/coarse pointer: neutralize any fallback hover tint that would re-lighten the seal. */
@media (hover: none), (pointer: coarse){
  #lexiconToggle:not(.has-selection):hover::after,
  #lexiconToggle:not(.has-selection):focus-visible::after{background-color:var(--lexicon-seal-face)}
}

/* -------------------------------------------------
   Flat-top Lexicon seal geometry (footer-only)
   ------------------------------------------------- */

#navFooter{
  /* Seal seating: raise the flat-top seal so its top edge aligns with the footer slab top. */
  --lexicon-seal-top-align:10px;

  /* Cradle seat (circle center y, relative to footer top): decouple from seal top-align so the notch tracks the seal. */
  --seal-cradle-center-y:0px;

  /* Legacy tokens still exist, but the cradle now uses --seal-cradle-center-y directly. */
  --seal-cradle-shift-y:0px;
  --seal-cradle-drop-y:var(--seal-cradle-center-y);

  --lexicon-seal-w:66px;
  --lexicon-seal-h:40px;

  /* ToC/Mirror tab spacing: toc.css consumes these tokens for the nav-seals cluster layout. */
  --toc-tab-gap:14px;

  /* Footer override forces ToC/Mirror plates to --nav-pill-width; keep shared geometry consistent. */
  --toc-tab-width:var(--nav-pill-width);

  /* Socket geometry: match the cradle line to the flat-top seal's new width. */
  --seal-notch-radius:calc(var(--lexicon-seal-w) * 0.5);
  --seal-notch-height:calc(var(--seal-notch-radius) + 6px);

  /* Void depth only: keep horizontal radius the same, but extend the carved void downward ~2px. */
  --seal-notch-radius-y:calc(var(--seal-notch-radius) + 2px);

  /* Border trace should follow the deeper void; give the tracing element enough height to render fully. */
  --seal-notch-height-y:calc(var(--seal-notch-radius-y) + 6px);

  /* Micro-nudges for glyph optical centering (mobile Safari). */
  --toc-glyph-nudge-x:0px;
  --mirror-glyph-nudge-x:0px;
  --toc-glyph-nudge-y:8px;
  --mirror-glyph-nudge-y:8px;

  /* iOS Safari: keep the dock pre-promoted as a stable layer (see assets/covenant.css + AGENT.md).
     Do not override transform here; only guard against "will-change" churn. */
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
  will-change:auto;
  isolation:isolate;
}

#navFooter::before,
#navFooter::after{-webkit-backface-visibility:hidden;backface-visibility:hidden;will-change:auto}

/* Cutout socket:
   Paint the slab on ::before, then punch the cradle notch out via a mask.
   This makes the cradle interior transparent (reads as a carved opening).
*/
#navFooter{background:radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%) !important;border-top:none !important;border-bottom:none !important;box-shadow:none !important}

#navFooter::before{
  content:'';
  position:absolute;
  inset:0;
  pointer-events:none;

  /* Same obsidian slab paint as assets/covenant.css (.nav-footer override block). */
  background:
    radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),
    linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%);

  background-position:0 0,0 0;

  /* Single top seam only (no second line beneath). */
  border-top:1px solid rgba(44,34,14,0.92);
  border-bottom:0;

  box-shadow:
    0 -14px 22px -14px rgba(0,0,0,0.78),
    inset 0 -10px 18px -16px rgba(0,0,0,0.72);

  /* Punch the cradle void (ellipse: same width, deeper downward).
     NOTE (iOS Safari): avoid half-pixel mask stops (can jitter by ~1px on reraster).
  */
  -webkit-mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% var(--seal-cradle-center-y, 0px),
    rgba(0,0,0,0) 0 98%,
    rgba(255,255,255,1) 99% 100%
  );
  mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% var(--seal-cradle-center-y, 0px),
    rgba(0,0,0,0) 0 98%,
    rgba(255,255,255,1) 99% 100%
  );
  -webkit-mask-repeat:no-repeat;
  mask-repeat:no-repeat;
  -webkit-mask-size:100% 100%;
  mask-size:100% 100%;
}

/* Cradle border: tracing line only (no interior fill). */
#navFooter::after{
  content:'';
  position:absolute;
  left:0;
  right:0;
  top:var(--seal-cradle-center-y, 0px);
  height:var(--seal-notch-height-y, var(--seal-notch-height));
  pointer-events:none;

  background:
    radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% 0%,
      transparent 0 97.8%,
      var(--footer-cradle-line) 98% 99%,
      transparent 99.4% 100%
    );

  opacity:0.95;
}

#navFooter #lexiconToggle,
#navFooter #lexiconToggle::before,
#navFooter #lexiconToggle::after{border-radius:0 0 999px 999px !important}

#navFooter #lexiconToggle{
  overflow:hidden;
  margin-top:calc(-1 * var(--lexicon-seal-top-align) + 4px) !important;

  /* Preserve drag math (lexicon.js drives --seal-drag-y). */
  transform:translateY(calc(0 * var(--seal-rise) + var(--seal-drag-y, 0px) - var(--seal-seat-nudge) + 0px)) !important;

  width:var(--lexicon-seal-w);
  height:var(--lexicon-seal-h);
}

@media (max-width: 600px){
  #navFooter{--toc-tab-gap:8px}
}

#navFooter #lexiconToggle{flex:0 0 var(--lexicon-seal-w)}

/* Citation label: keep it present even when empty (altar-leading emphasis). */
#navFooter .citation-label{margin-top:4px;min-height:18px;display:block !important;visibility:visible !important}
#navFooter .citation-label:empty{display:block !important;visibility:visible !important}

@media (max-width: 600px){
  #navFooter .citation-label{margin-top:2px;min-height:16px}

  #navFooter .nav-next-label,
  #navFooter .nav-prev-label{font-size:0.78rem;letter-spacing:0.10em;opacity:0.86}
}

@media (max-width: 480px){
  #navFooter .nav-next-label,
  #navFooter .nav-prev-label{font-size:0.76rem;opacity:0.8}
}
