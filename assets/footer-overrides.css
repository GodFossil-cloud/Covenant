/* Footer overrides (head-loaded)
   Purpose: keep footer geometry + tones stable on first paint (especially iPhone Safari).

   This file consolidates:
   - nav-footer-flat-top.css (Lexicon seal flat-top geometry + socket/cradle shaping)
   - footer-tones.css (small contrast/ink nudges for dock tabs + Lexicon seal)

   Scope:
   - Geometry rules target #navFooter to avoid bleed.
   - Tone variables are global (as before) because toc.css consumes them.
*/

/* -------------------------------------------------
   Tone nudges (subtle contrast tuning)
   ------------------------------------------------- */

:root{
  /* Dock tab medallion surface (used by ToC + Mirror caps via toc.css).
     Single source of truth: toc.css must not redeclare this token. */
  --dock-tab-face:#010103;

  /* Lexicon seal: closed/base surface tones (keep selection/leaf styling untouched). */
  --lexicon-seal-face:#08090b;
  --lexicon-seal-face-hover:#0a0b0e;

  /* Lexicon cradle (the upward-facing semicircle behind the seal): 1px taller. */
  --lexicon-cradle-h:calc(var(--seal-notch-height) + 0px);
}

/* Darken the Lexicon seal base (closed state). */
#lexiconToggle.nav-btn.center:not(.has-selection)::after{background-color:var(--lexicon-seal-face)}

/* Preserve interaction feedback while staying within the darker scheme. */
#lexiconToggle.nav-btn.center:not(.has-selection):hover::after,
#lexiconToggle.nav-btn.center:not(.has-selection):focus-visible::after{background-color:var(--lexicon-seal-face-hover)}

/* Lexicon tab: shrink glyph only (do not alter seal/cradle geometry). */
#navFooter #lexiconToggle .lexicon-glyph{font-size:0.90em !important}

/* Make the Lexicon seal cradle border/field 1px taller without touching socket geometry tokens. */
.nav-footer::after{height:var(--lexicon-cradle-h, var(--seal-notch-height))}

/* Touch/coarse pointer: neutralize any fallback hover tint that would re-lighten the seal. */
@media (hover: none), (pointer: coarse){
  #lexiconToggle:not(.has-selection):hover::after,
  #lexiconToggle:not(.has-selection):focus-visible::after{background-color:var(--lexicon-seal-face)}
}

/* -------------------------------------------------
   Flat-top Lexicon seal geometry (footer-only)
   ------------------------------------------------- */

#navFooter{
  /* Seal seating: raise the flat-top seal so its top edge aligns with the footer slab top.
     IMPORTANT (iPhone Safari): navFooterCritical defines this token later in the DOM.
     Use !important so vertical positioning changes actually take effect. */
  --lexicon-seal-top-align:13px !important;

  /* Cradle seat (circle center y, relative to footer top): decouple from seal top-align so the notch tracks the seal. */
  --seal-cradle-center-y:0px;

  /* Legacy tokens still exist, but the cradle now uses --seal-cradle-center-y directly. */
  --seal-cradle-shift-y:0px;
  --seal-cradle-drop-y:var(--seal-cradle-center-y);

  /* Lexicon SEAL size.
     IMPORTANT: must beat the inline iPhone "navFooterCritical" safety-net (later in DOM). */
  --lexicon-seal-w:66px !important;
  --lexicon-seal-h:34px !important;

  /* ToC/Mirror: slightly larger + slightly more spread, without touching Prev/Next. */
  --toc-tab-gap:26px !important;
  --toc-tab-width:calc(var(--nav-pill-width) + 8px);
  --dock-socket-spread:8px;

  /* Socket geometry: cradle dock size (independent of seal). */
  --lexicon-cradle-w:66px;

  /* Tighten the void a touch more (so "smaller" reads even with antialias). */
  --seal-notch-grow:1px;

  /* IMPORTANT (iPhone Safari): navFooterCritical defines these same tokens later in the DOM.
     Use !important so cradle geometry stays authoritative and responds to --lexicon-cradle-w changes. */
  --seal-notch-radius:calc(var(--lexicon-cradle-w) * 0.5 + var(--seal-notch-grow)) !important;
  --seal-notch-height:calc(var(--seal-notch-radius) + 6px) !important;

  /* Cradle depth: pull this back hard (smaller dock vertically). */
  --seal-notch-radius-y:calc(var(--seal-notch-radius) + 0px) !important;

  /* Border trace should follow the deeper void; give the tracing element enough height to render fully. */
  --seal-notch-height-y:calc(var(--seal-notch-radius-y) + 6px) !important;

  /* Micro-nudges for glyph optical centering (mobile Safari). */
  --toc-glyph-nudge-x:0px;
  --mirror-glyph-nudge-x:0px;
  --toc-glyph-nudge-y:8px;
  --mirror-glyph-nudge-y:8px;

  /* Prev/Next frames: slightly larger than the ToC/Mirror pill size (all breakpoints). */
  --nav-wing-pill-w:calc(var(--nav-pill-width) + 10px);
  --nav-wing-pill-h:calc(var(--nav-pill-height) + 8px);

  /* iOS Safari: keep the dock pre-promoted as a stable layer (see assets/covenant.css + AGENT.md).
     Do not override transform here; only guard against "will-change" churn. */
  -webkit-backface-visibility:hidden;
  backface-visibility:hidden;
  will-change:auto;
  isolation:isolate;
}

/* Widen the footer dock more so Prev/Next sit further from the center (all breakpoints). */
#navFooter .nav-footer-inner{
  max-width:1120px;
  padding:0 2px;
}

#navFooter::before,
#navFooter::after{-webkit-backface-visibility:hidden;backface-visibility:hidden;will-change:auto}

/* Cutout socket:
   Paint the slab on ::before, then punch the cradle notch out via a mask.
   This makes the cradle interior transparent (reads as a carved opening).
*/
#navFooter{background:radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%) !important;border-top:none !important;border-bottom:none !important;box-shadow:none !important}

#navFooter::before{
  content:'';
  position:absolute;
  inset:0;
  pointer-events:none;

  /* Same obsidian slab paint as assets/covenant.css (.nav-footer override block). */
  background:
    radial-gradient(1200px 90px at 50% 0%, rgba(255,255,255,0.06), rgba(255,255,255,0) 55%),
    linear-gradient(to bottom, var(--obsidian-2) 0%, var(--obsidian-1) 45%, var(--obsidian-0) 100%);

  background-position:0 0,0 0;

  /* Single top seam only (no second line beneath). */
  border-top:1px solid rgba(44,34,14,0.92);
  border-bottom:0;

  box-shadow:
    0 -14px 22px -14px rgba(0,0,0,0.78),
    inset 0 -10px 18px -16px rgba(0,0,0,0.72);

  /* Punch the cradle void (ellipse: wider + deeper).
     NOTE (iOS Safari): avoid half-pixel mask stops (can jitter by ~1px on reraster).
  */
  -webkit-mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% var(--seal-cradle-center-y, 0px),
    rgba(0,0,0,0) 0 98%,
    rgba(255,255,255,1) 99% 100%
  );
  mask-image:radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% var(--seal-cradle-center-y, 0px),
    rgba(0,0,0,0) 0 98%,
    rgba(255,255,255,1) 99% 100%
  );
  -webkit-mask-repeat:no-repeat;
  mask-repeat:no-repeat;
  -webkit-mask-size:100% 100%;
  mask-size:100% 100%;
}

/* Cradle border: tracing line only (no interior fill). */
#navFooter::after{
  content:'';
  position:absolute;
  left:0;
  right:0;
  top:var(--seal-cradle-center-y, 0px);
  height:var(--seal-notch-height-y, var(--seal-notch-height));
  pointer-events:none;

  background:
    radial-gradient(ellipse var(--seal-notch-radius) var(--seal-notch-radius-y) at 50% 0%,
      transparent 0 96.9%,
      var(--footer-cradle-line) 97.15% 99.35%,
      transparent 99.6% 100%
    );

  opacity:0.95;
}

#navFooter #lexiconToggle,
#navFooter #lexiconToggle::before,
#navFooter #lexiconToggle::after{border-radius:0 0 999px 999px !important}

#navFooter #lexiconToggle{
  overflow:hidden;
  margin-top:calc(-1 * var(--lexicon-seal-top-align) + 4px) !important;

  /* Preserve drag math (lexicon.js drives --seal-drag-y). */
  transform:translateY(calc(0 * var(--seal-rise) + var(--seal-drag-y, 0px) - var(--seal-seat-nudge) + 0px)) !important;

  width:var(--lexicon-seal-w);
  height:var(--lexicon-seal-h);
}

@media (max-width: 600px){
  #navFooter{--toc-tab-gap:12px !important}
}

#navFooter #lexiconToggle{flex:0 0 var(--lexicon-seal-w)}

/* Prev/Next: larger frames, remove brass border outline. */
#navFooter .nav-next-frame,
#navFooter .nav-prev-frame{
  width:var(--nav-wing-pill-w);
  height:var(--nav-wing-pill-h);
}

#navFooter .nav-next-frame::before,
#navFooter .nav-prev-frame::before{
  border:0 !important;
  box-shadow:
    inset 0 0 18px rgba(0, 0, 0, 0.92),
    inset 0 1px 0 rgba(255, 255, 255, 0.05),
    0 0 0 1px rgba(0, 0, 0, 0.72);
}

#navFooter .nav-next-frame .nav-btn-icon,
#navFooter .nav-prev-frame .nav-btn-icon{
  font-size:1.55rem;
}

/* Citation label: keep it present even when empty (altar-leading emphasis).
   NOTE: covenant.css intentionally sets .citation-label { pointer-events: none; }.
   Here we override that so the label can be tapped to copy. */
#navFooter .citation-label{
  margin-top:4px;
  min-height:18px;
  display:flex !important;
  align-items:center;
  justify-content:center;
  position:relative;
  visibility:visible !important;
  pointer-events:auto;
}
#navFooter .citation-label:empty{display:flex !important;visibility:visible !important}

#navFooter .citation-copy{
  display:inline-block;
  border:0;
  background:transparent;
  padding:0;
  margin:0;
  font:inherit;
  color:inherit;
  letter-spacing:inherit;
  text-transform:inherit;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  pointer-events:auto;
}

#navFooter .citation-copy:focus-visible{
  outline:1px solid rgba(212, 170, 78, 0.65);
  outline-offset:4px;
  border-radius:6px;
}

/* "Copied" momentarily replaces the citation text (JS swaps #citationText content).
   Style it as a faint pill so it reads cleanly against the dock gradient. */
#navFooter .citation-label.is-copied #citationText{
  display:inline-block;
  color:var(--citation-color, rgba(242, 220, 154, 0.96));
  text-shadow:
    0 1px 1px rgba(0, 0, 0, 0.96),
    0 0 12px rgba(242, 220, 154, 0.18);

  background:rgba(0, 0, 0, 0.58);
  border:1px solid rgba(242, 220, 154, 0.22);
  border-radius:999px;
  padding:2px 9px 3px;

  letter-spacing:0.14em;
  line-height:1.08;
}

@media (max-width: 600px){
  #navFooter .citation-label{margin-top:2px;min-height:16px}

  #navFooter .nav-next-label,
  #navFooter .nav-prev-label{font-size:0.78rem;letter-spacing:0.10em;opacity:0.86}
}

@media (max-width: 480px){
  #navFooter .nav-next-label,
  #navFooter .nav-prev-label{font-size:0.76rem;opacity:0.8}
}
