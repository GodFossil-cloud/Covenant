/*! Covenant ToC Panel Styles v2.3.5 (Darker Unlocked Rim + Chapel Rope Gate) */

:root{--toc-scroll-cap:24px;--toc-scroll-open-duration:520ms;--toc-scroll-close-duration:320ms;--toc-scroll-duration:var(--toc-scroll-open-duration);--toc-scroll-ease:cubic-bezier(.22,.61,.36,1);--toc-scroll-opacity-in:140ms;--toc-rollband-height:calc(var(--toc-scroll-cap) * 0.85);--toc-footer-fade:220ms;--toc-ink:rgba(44,62,80,.92);--toc-ink-soft:rgba(44,62,80,.74);--toc-rule:rgba(139,115,85,.26);--toc-rule-strong:rgba(139,115,85,.36);--toc-parchment:rgba(247,244,238,1);--toc-parchment-hi:rgba(255,255,255,.72);--toc-rule-x:.95rem;--toc-node:10px;--toc-brass:rgba(201,169,97,1);--toc-node-locked:8px}

.section-header.has-toc-toggle{position:relative}
.section-header.has-toc-toggle h1{transition:text-shadow 220ms ease,filter 220ms ease}
.section-header.toc-title-sheen h1{text-shadow:0 0 14px rgba(201,169,97,.18),0 0 1px rgba(255,255,255,.16);filter:brightness(1.02)}

.toc-toggle{position:absolute;z-index:1500;padding:0;margin:0;border:none;background:transparent;cursor:pointer;pointer-events:auto;-webkit-tap-highlight-color:transparent;touch-action:pan-y;user-select:none;-webkit-user-select:none}
.toc-toggle:focus-visible{outline:2px solid rgba(201,169,97,.45);outline-offset:4px}

.toc-toggle--floating{position:fixed;top:14px;left:14px;width:44px;height:44px;display:inline-grid;place-items:center;color:rgba(44,62,80,.72)}
.toc-toggle-glyph{font-size:1.15rem;line-height:1;transform:translateY(-.5px)}

html.lexicon-scroll-lock .toc-toggle{opacity:0;visibility:hidden;pointer-events:none}

html.toc-scroll-lock{overflow:hidden}
body.toc-scroll-lock{position:fixed;width:100%}

/* Animate the Lexicon seal into a "receded" (locked) posture while the ToC is open.
   NOTE: toc.css is loaded BEFORE covenant.css via _includes/covenant-config.html.
   Use a slightly higher-specificity selector so our transition is not overridden on mobile.

   IMPORTANT: do not animate opacity/filter here; it reads as a fade. */
html #lexiconToggle{transition:color .2s ease,text-shadow .2s ease,transform var(--lexicon-snap-duration) var(--lexicon-snap-ease)}

/* Footer fade choreography (edge lines + cradle + citation label). */
html .nav-footer{isolation:isolate;transition:border-top-color var(--toc-footer-fade) var(--toc-scroll-ease),border-bottom-color var(--toc-footer-fade) var(--toc-scroll-ease)}
html .nav-footer::before,html .nav-footer::after{transition:opacity var(--toc-footer-fade) var(--toc-scroll-ease);will-change:opacity}
html #citationLabel{transition:opacity var(--toc-footer-fade) var(--toc-scroll-ease),visibility 0s linear 0s}

/* While the ToC is open (and while it is closing), keep the seal BELOW the cradle layers,
   but ABOVE any footer-dimming layer so it never appears "washed" or sliced by overlays. */
html.toc-open #lexiconToggle,html.toc-closing #lexiconToggle{z-index:3}
html.toc-open .nav-footer::after,html.toc-closing .nav-footer::after{z-index:6}
html.toc-open .nav-footer::before,html.toc-closing .nav-footer::before{z-index:6}

/* Fade edge lines (footer top/bottom borders) while ToC is open/closing. */
html.toc-open .nav-footer,html.toc-closing .nav-footer{border-top-color:transparent;border-bottom-color:transparent}

/* While the ToC is open/closing, fade the citation label under the seal.
   Keep layout stable; make it visually silent, and only flip visibility after the fade. */
html.toc-open #citationLabel,html.toc-closing #citationLabel{opacity:0;visibility:hidden;transition:opacity var(--toc-footer-fade) var(--toc-scroll-ease),visibility 0s linear var(--toc-footer-fade)}

/* During ToC open/close, fade the footer's cradle/hairline accents.
   - ::before is the thin top hairline.
   - ::after is the cradle semicircle; fading it prevents a dark "socket" from appearing when the seal recedes. */
html.toc-open .nav-footer::before,html.toc-closing .nav-footer::before{opacity:0}
html.toc-open .nav-footer::after,html.toc-closing .nav-footer::after{opacity:0}

/* Dim the footer slab while ToC is open/closing, but keep the nav buttons fully bright.
   This avoids "dimming-but-still-clickable" confusion for Prev/Next.

   NOTE: The dim layer must sit BELOW #lexiconToggle, otherwise the seal can look briefly
   semi-transparent (and a horizontal edge can read as a "line" through the wax). */
html.toc-open .nav-footer-inner,html.toc-closing .nav-footer-inner{position:relative}
html.toc-open .nav-footer-inner::before,html.toc-closing .nav-footer-inner::before{content:'';position:absolute;inset:0;background:rgba(0,0,0,.32);pointer-events:none;z-index:1}
html.toc-open .nav-prev,html.toc-open .nav-next,html.toc-open .nav-btn:not(#lexiconToggle),html.toc-closing .nav-prev,html.toc-closing .nav-next,html.toc-closing .nav-btn:not(#lexiconToggle){position:relative;z-index:2}

/* Micro-glint: a quick "latch click" before the seal recedes (subtle, sacred). */
@keyframes lexiconSealLatchGlint{0%{box-shadow:inset 0 0 18px rgba(0,0,0,.84),inset 0 1px 0 rgba(255,255,255,.05),0 10px 18px -14px rgba(0,0,0,.90),0 14px 10px -12px rgba(0,0,0,.92)}45%{box-shadow:inset 0 0 20px rgba(0,0,0,.90),inset 0 1px 0 rgba(255,255,255,.10),0 0 0 1px rgba(242,220,154,.20),0 0 14px rgba(242,220,154,.12),0 14px 10px -12px rgba(0,0,0,.92)}100%{box-shadow:inset 0 0 18px rgba(0,0,0,.84),inset 0 1px 0 rgba(255,255,255,.05),0 10px 18px -14px rgba(0,0,0,.90),0 14px 10px -12px rgba(0,0,0,.92)}}
@keyframes lexiconSealLatchSurface{0%{background-color:var(--obsidian-1)}45%{background-color:#141418}100%{background-color:var(--obsidian-1)}}

html.toc-open #lexiconToggle::before{animation:lexiconSealLatchGlint 140ms ease-out 1}
html.toc-open #lexiconToggle::after{animation:lexiconSealLatchSurface 140ms ease-out 1}

/* Delay the recede just long enough for the latch glint to read.
   NOTE: keep the seal fully opaque, and do not dim it (no filter fade). */
html.toc-open #lexiconToggle{transition-delay:160ms;pointer-events:none;--seal-seat-nudge:-8px}

@media (prefers-reduced-motion: reduce){html #lexiconToggle{transition:none}html.toc-open #lexiconToggle{transition-delay:0ms}html.toc-open #lexiconToggle::before,html.toc-open #lexiconToggle::after{animation:none}}

/* Do not dim the footer itself via the overlay; we dim the slab with a dedicated layer above.
   This also prevents accidental pointer blocking on the footer region. */
.toc-overlay{position:fixed;inset:0 0 var(--footer-total-height) 0;background:rgba(0,0,0,.6);z-index:1400;opacity:0;pointer-events:none;transition:opacity 340ms cubic-bezier(.22,.61,.36,1)}
.toc-overlay.is-open{opacity:1;pointer-events:auto}

/* Panel: parchment that unfurls like a scroll.
   Cathedral Index: keep the unfurl, but make the interior read like an archive index. */
.toc-panel{position:fixed;left:50%;top:110px;max-height:70vh;width:min(760px,calc(100vw - 24px));background:linear-gradient(to bottom,var(--toc-parchment) 0%,var(--toc-parchment) 80%,rgba(247,244,238,0) 100%);border:1px solid rgba(44,62,80,.16);border-bottom-color:transparent;box-shadow:0 22px 60px rgba(0,0,0,.24),0 8px 24px rgba(0,0,0,.14),inset 0 18px 22px -22px rgba(0,0,0,.42);border-radius:0 0 16px 16px;z-index:1401;opacity:0;transform:translateX(-50%) translateY(-10px);transform-origin:50% 0;transition:transform 300ms var(--toc-scroll-ease),opacity var(--toc-scroll-opacity-in) ease;display:flex;flex-direction:column;overflow:hidden;background-clip:padding-box;will-change:clip-path,opacity,transform}
.toc-panel.is-open{opacity:1;transform:translateX(-50%) translateY(0)}
.toc-panel.is-closing{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:none;--toc-scroll-duration:var(--toc-scroll-close-duration)}
.toc-panel[aria-hidden="true"]{pointer-events:none}
.toc-panel[aria-hidden="false"]{pointer-events:auto}

@supports ((clip-path: inset(10px)) or (-webkit-clip-path: inset(10px))){
  .toc-panel{transform:translateX(-50%);transition:clip-path var(--toc-scroll-duration) var(--toc-scroll-ease),-webkit-clip-path var(--toc-scroll-duration) var(--toc-scroll-ease),opacity var(--toc-scroll-opacity-in) ease;clip-path:inset(0 0 calc(100% - var(--toc-scroll-cap)) 0 round 0 0 16px 16px);-webkit-clip-path:inset(0 0 calc(100% - var(--toc-scroll-cap)) 0 round 0 0 16px 16px)}
  .toc-panel.is-open{clip-path:inset(0 0 0 0 round 0 0 16px 16px);-webkit-clip-path:inset(0 0 0 0 round 0 0 16px 16px)}
  .toc-panel.is-closing{clip-path:inset(0 0 calc(100% - var(--toc-scroll-cap)) 0 round 0 0 16px 16px);-webkit-clip-path:inset(0 0 calc(100% - var(--toc-scroll-cap)) 0 round 0 0 16px 16px)}
}

/* Rolled cylinder (micro): a moving highlight/shadow band keyed to --toc-scroll-cap. */
@keyframes tocRollBandIn{0%{opacity:0;transform:translateY(calc(-.55 * var(--toc-scroll-cap)))}22%{opacity:.92;transform:translateY(0)}62%{opacity:.38;transform:translateY(0)}100%{opacity:0;transform:translateY(0)}}
@keyframes tocRollBandOut{0%{opacity:0;transform:translateY(0)}30%{opacity:.52;transform:translateY(0)}68%{opacity:.92;transform:translateY(calc(-.10 * var(--toc-scroll-cap)))}100%{opacity:0;transform:translateY(calc(-.55 * var(--toc-scroll-cap)))}}

.toc-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:var(--toc-rollband-height);pointer-events:none;opacity:0;transform:translateY(calc(-.55 * var(--toc-scroll-cap)));background:radial-gradient(120% 90% at 50% 0%,rgba(255,255,255,.55) 0%,rgba(255,255,255,0) 56%),linear-gradient(to bottom,rgba(0,0,0,.26) 0%,rgba(0,0,0,0) 78%);filter:blur(.2px)}

.toc-panel.is-open::before{animation:tocRollBandIn var(--toc-scroll-duration) var(--toc-scroll-ease) 1 both}
.toc-panel.is-closing::before{animation:tocRollBandOut var(--toc-scroll-duration) var(--toc-scroll-ease) 1 both}

@media (prefers-reduced-motion: reduce){.toc-panel.is-open::before,.toc-panel.is-closing::before{animation:none}.toc-panel::before{display:none}}

/* Keep ::after unused to avoid reintroducing a hard hairline. */
.toc-panel::after{content:none}

.toc-panel-header{position:relative;padding:0;border:0;background:transparent;height:0}
.toc-panel-title,.toc-panel-subtitle{display:none}

/* IMPORTANT: allow vertical scrolling inside the panel body. */
.toc-panel-body{flex:1;overflow-y:auto;overflow-x:hidden;padding:1.25rem 1.35rem 1.25rem;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;touch-action:pan-y;position:relative}

/* Inner grain + vignette for dimensional parchment. */
.toc-panel-body::before{content:'';position:absolute;inset:0;background:radial-gradient(900px 420px at 50% 0%,rgba(201,169,97,.06),rgba(201,169,97,0) 55%),radial-gradient(900px 520px at 50% 120%,rgba(0,0,0,.05),rgba(0,0,0,0) 60%),linear-gradient(to bottom,var(--toc-parchment-hi),rgba(255,255,255,0));pointer-events:none}

.toc-panel-body>*{position:relative}

/* -------------------------------------------------
   Cathedral Index: structure + typography
   ------------------------------------------------- */

.toc-index{position:relative;color:var(--toc-ink)}

/* The Scriptorium rule: a quiet vertical margin line. */
.toc-index::before{content:'';position:absolute;top:.3rem;bottom:2.9rem;left:var(--toc-rule-x);width:1px;background:linear-gradient(to bottom,transparent 0%,var(--toc-rule) 10%,var(--toc-rule) 90%,transparent 100%);box-shadow:0 0 0 1px rgba(255,255,255,.18);pointer-events:none}

/* Groups */
.toc-group + .toc-group{margin-top:1.05rem;padding-top:.95rem;border-top:1px solid rgba(44,62,80,.14)}

.toc-group-title{margin:0 0 .6rem 0;padding-left:1.65rem}

/* Subtle tab label (borrowed from Index Tabs), but kept archival. */
.toc-tab{display:inline-block;padding:.26rem .7rem;border:1px solid rgba(44,62,80,.16);border-bottom-color:rgba(44,62,80,.24);background:linear-gradient(to bottom,rgba(255,255,255,.62),rgba(255,255,255,.18));border-radius:999px;font-family:'Cormorant Garamond',serif;font-size:.92rem;font-weight:600;letter-spacing:.14em;text-transform:none;font-variant-caps:all-small-caps;color:var(--toc-ink-soft);box-shadow:0 1px 0 rgba(255,255,255,.35),0 10px 20px rgba(0,0,0,.06)}

/* Lists */
.toc-list{list-style:none;max-width:100%;padding:0;margin:0}

.toc-item{margin:0 0 .42rem;display:block;max-width:100%;position:relative}

/* Progression nodes (visual linear sequence).
   Make the fill opaque so the margin rule does not show through.
   Darken the rim slightly so the markers read faster at a glance. */
.toc-item::before{content:'';position:absolute;left:calc(var(--toc-rule-x) - (var(--toc-node) / 2));top:50%;transform:translateY(-50%);width:var(--toc-node);height:var(--toc-node);border-radius:999px;background:rgba(247,244,238,.98);border:1px solid rgba(139,115,85,.66);box-shadow:0 0 0 1px rgba(255,255,255,.22),0 10px 14px rgba(0,0,0,.04);pointer-events:none}

.toc-item--current::before{background:rgba(247,244,238,1);border-color:rgba(139,115,85,.78);box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 18px rgba(201,169,97,.12),0 10px 14px rgba(0,0,0,.04)}

/* Locked nodes: slightly smaller than unlocked (subtle hierarchy), no ornament. */
.toc-item--locked::before{left:calc(var(--toc-rule-x) - (var(--toc-node-locked) / 2));width:var(--toc-node-locked);height:var(--toc-node-locked);background:rgba(247,244,238,.96);border:1px solid rgba(201,169,97,.52);box-shadow:0 0 0 1px rgba(255,255,255,.18)}

/* Gate marker: one clean brass bar before the first locked page in a group,
   with a faint "chapel rope" stroke across it (no icons, no extra symbols). */
.toc-gate{list-style:none;position:relative;height:16px;margin:.25rem 0 .62rem}
.toc-gate::before{content:'';position:absolute;left:calc(var(--toc-rule-x) + .55rem);right:.2rem;top:50%;height:3px;border-radius:999px;background-image:linear-gradient(to right,rgba(201,169,97,.92),rgba(201,169,97,.18),rgba(201,169,97,0)),linear-gradient(to bottom,rgba(0,0,0,0),rgba(44,62,80,.10),rgba(0,0,0,0));background-repeat:no-repeat;opacity:1}
.toc-gate::after{content:'';position:absolute;left:calc(var(--toc-rule-x) - 5px);top:50%;transform:translateY(-50%);width:10px;height:10px;border-radius:999px;background:rgba(201,169,97,.30);border:1px solid rgba(201,169,97,.62);box-shadow:0 0 0 1px rgba(255,255,255,.16)}

.toc-item-btn,.toc-locked-btn{display:block;width:100%;background:none;border:0;padding:.26rem 0 .26rem 1.65rem;margin:0;font:inherit;font-size:1rem;line-height:1.55;text-align:left;white-space:normal;overflow-wrap:anywhere}

/* Entry layout: key + title */
.toc-entry{display:flex;gap:.7rem;align-items:baseline;min-width:0}
.toc-entry-key{flex:0 0 auto;min-width:7.9rem;font-family:'Cormorant Garamond',serif;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps;color:var(--toc-ink-soft)}
.toc-entry-title{flex:1 1 auto;min-width:0;color:var(--toc-ink)}

.toc-entry--single .toc-entry-title{color:var(--toc-ink)}

/* Interaction */
.toc-item-btn{cursor:pointer;transition:color 200ms ease}
.toc-item-btn:hover .toc-entry-title,.toc-item-btn:focus-visible .toc-entry-title{color:#111;text-decoration:underline;text-decoration-color:rgba(139,115,85,.55);text-decoration-thickness:1px;text-underline-offset:3px}
.toc-item-btn:focus-visible{outline:2px solid rgba(201,169,97,.38);outline-offset:3px}
.toc-item-btn:disabled{cursor:default}

.toc-item--current .toc-entry-title{font-weight:600;color:#111}
.toc-item--current .toc-entry-key{color:rgba(44,62,80,.86)}

/* Locked */
.toc-locked-btn{color:rgba(120,120,120,.95);cursor:not-allowed;position:relative}
.toc-locked-btn:focus-visible{outline:2px solid rgba(201,169,97,.26);outline-offset:3px}
.toc-item--locked .toc-entry-key{color:rgba(120,120,120,.72)}
.toc-item--locked .toc-entry-title{color:rgba(120,120,120,.95)}

/* Annex: Lexicon link (not a full group) */
.toc-annex{margin-top:1.05rem;padding-top:.95rem;border-top:1px solid rgba(44,62,80,.14)}
.toc-annex-link{display:inline-flex;align-items:baseline;gap:.6rem;padding:.4rem .2rem .2rem 1.65rem;text-decoration:none;color:var(--toc-ink-soft);transition:color 200ms ease}
.toc-annex-link:hover,.toc-annex-link:focus-visible{color:#111;text-decoration:underline;text-decoration-color:rgba(139,115,85,.55);text-decoration-thickness:1px;text-underline-offset:3px}
.toc-annex-link:focus-visible{outline:2px solid rgba(201,169,97,.30);outline-offset:4px}
.toc-annex-sigil{font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;color:rgba(139,115,85,.62)}
.toc-annex-text{font-family:'Cormorant Garamond',serif;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps}

/* Mobile-friendly locked feedback (native title tooltips are unreliable on touch devices). */
.toc-toast{position:sticky;bottom:.65rem;margin:.95rem auto 0;width:fit-content;max-width:min(520px,92%);padding:.6rem 1rem;border-radius:999px;background:rgba(11,12,14,.92);color:rgba(245,245,240,.96);font-size:.95rem;letter-spacing:.04em;line-height:1.25;text-align:center;box-shadow:0 14px 30px rgba(0,0,0,.22),0 2px 10px rgba(0,0,0,.12);opacity:0;transform:translateY(6px);pointer-events:none;transition:opacity 420ms ease,transform 180ms ease}
.toc-toast.is-visible{opacity:1;transform:translateY(0)}
@media (prefers-reduced-motion: reduce){.toc-toast{transition:none;transform:none}.toc-toast.is-visible{transform:none}}

@media (prefers-reduced-motion: reduce){:root{--toc-scroll-open-duration:1ms;--toc-scroll-close-duration:1ms;--toc-scroll-duration:1ms;--toc-scroll-opacity-in:1ms}.toc-overlay{transition:none}.toc-panel{transition:opacity 160ms ease !important;transform:translateX(-50%) !important;clip-path:none !important;-webkit-clip-path:none !important}}

@media (max-width:600px){
  :root{--toc-rule-x:.75rem;--toc-node:10px;--toc-node-locked:8px}
  .toc-panel{width:calc(100vw - 18px);border-radius:0 0 14px 14px}
  .toc-panel-body{padding:1.1rem 1.1rem 1.05rem}
  .toc-group-title,.toc-item-btn,.toc-locked-btn,.toc-annex-link{padding-left:1.45rem}
  .toc-entry-key{min-width:6.9rem}
}
