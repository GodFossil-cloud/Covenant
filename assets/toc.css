/*! Covenant ToC Panel Styles v3.0.6 (Modal Veil + Footer Seal + Hold-to-Enter) */

:root{
  --toc-scroll-open-duration:520ms;
  --toc-scroll-close-duration:320ms;
  --toc-scroll-duration:var(--toc-scroll-open-duration);
  --toc-scroll-ease:cubic-bezier(.22,.61,.36,1);
  --toc-scroll-opacity-in:140ms;

  --toc-ink:rgba(44,62,80,.92);
  --toc-ink-soft:rgba(44,62,80,.74);
  --toc-rule:rgba(139,115,85,.26);
  --toc-rule-strong:rgba(139,115,85,.36);

  --toc-parchment:rgba(247,244,238,1);
  --toc-parchment-hi:rgba(255,255,255,.72);

  --toc-brass:rgba(201,169,97,1);

  --toc-rule-x:.95rem;
  --toc-node:10px;
  --toc-node-locked:8px;
  --toc-item-pad-y:.26rem;
  --toc-item-line:1.55;

  /* Footer seal (ToC) sizing. Keep Lexicon cradle geometry intact; this only shapes the ToC control itself. */
  --toc-seal-size:42px;
  --toc-seal-width:48px;
  --toc-seal-top-radius:6px;

  /* Optional: reserve a little top breathing-room when computing max height in JS. */
  --toc-top-safe:14px;
}

/* -------------------------------------------------
   Footer seal (ToC toggle)
   ------------------------------------------------- */

/* Keep ToC seal silent while Lexicon is open (avoid two competing doors). */
html.lexicon-scroll-lock #tocToggle{opacity:0;visibility:hidden;pointer-events:none}

/* Keep Lexicon seal centered in its cradle:
   Use a symmetric 3-column row: [ToC] [Lexicon] [spacer]. */
.nav-seals{display:grid;grid-template-columns:var(--seal-size) var(--seal-size) var(--seal-size);column-gap:10px;align-items:center;justify-content:center;min-width:0}
.nav-seal-spacer{width:var(--seal-size);height:var(--seal-size);pointer-events:none;visibility:hidden}
@media (max-width:600px){.nav-seals{column-gap:8px}}

/* The footer already provides the cradle; this gives the ToC seal its own shape + scale.
   Shape: softly rounded corners on top, rounded bottom (half-pill). */
html #tocToggle.toc-seal{
  position:relative;
  width:var(--toc-seal-width);
  height:var(--toc-seal-size);
  border-radius:var(--toc-seal-top-radius) var(--toc-seal-top-radius) 999px 999px;
  justify-self:center;
  align-self:center;

  /* Counter the Lexicon seal's lift (inherited from .nav-btn.center) so the ToC seal sits inside the dock.
     Fine-tuned so the top edge aligns with the dock's top surface. */
  transform:translateY(-15px);
}

html #tocToggle.toc-seal::before,
html #tocToggle.toc-seal::after{
  border-radius:var(--toc-seal-top-radius) var(--toc-seal-top-radius) 999px 999px;
}

html #tocToggle.toc-seal .toc-glyph{font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;font-size:.88rem;line-height:1;transform:translateY(-.5px);display:inline-block}

/* When ToC is open, keep the seal above the footer dim layer (same policy as Lexicon). */
html.toc-open #tocToggle,html.toc-closing #tocToggle{position:relative;z-index:3}

/* -------------------------------------------------
   Scroll lock
   ------------------------------------------------- */

html.toc-scroll-lock{overflow:hidden}
body.toc-scroll-lock{position:fixed;width:100%}

/* -------------------------------------------------
   Footer fade choreography
   ------------------------------------------------- */

html .nav-footer{isolation:isolate;transition:border-top-color 220ms var(--toc-scroll-ease),border-bottom-color 220ms var(--toc-scroll-ease)}
html .nav-footer::before,html .nav-footer::after{transition:opacity 220ms var(--toc-scroll-ease);will-change:opacity}
html #citationLabel{transition:opacity 220ms var(--toc-scroll-ease),visibility 0s linear 0s}

html.toc-open .nav-footer,html.toc-closing .nav-footer{border-top-color:transparent;border-bottom-color:transparent}
html.toc-open #citationLabel,html.toc-closing #citationLabel{opacity:0;visibility:hidden;transition:opacity 220ms var(--toc-scroll-ease),visibility 0s linear 220ms}
html.toc-open .nav-footer::before,html.toc-closing .nav-footer::before{opacity:0}
html.toc-open .nav-footer::after,html.toc-closing .nav-footer::after{opacity:0}

html.toc-open .nav-footer-inner,html.toc-closing .nav-footer-inner{position:relative}
html.toc-open .nav-footer-inner::before,html.toc-closing .nav-footer-inner::before{content:'';position:absolute;inset:0;background:rgba(0,0,0,.32);pointer-events:none;z-index:1}
html.toc-open .nav-prev,html.toc-open .nav-next,html.toc-open .nav-btn:not(#lexiconToggle):not(#tocToggle),
html.toc-closing .nav-prev,html.toc-closing .nav-next,html.toc-closing .nav-btn:not(#lexiconToggle):not(#tocToggle){position:relative;z-index:2}

/* -------------------------------------------------
   Modal veil
   ------------------------------------------------- */

/* Do not cover the footer; the dock stays sovereign. */
.toc-overlay{position:fixed;inset:0 0 var(--footer-total-height) 0;background:rgba(0,0,0,.64);z-index:1400;opacity:0;pointer-events:none;transition:opacity 340ms var(--toc-scroll-ease)}
.toc-overlay.is-open{opacity:1;pointer-events:auto}

/* -------------------------------------------------
   Panel (anchored above footer)
   ------------------------------------------------- */

.toc-panel{
  position:fixed;
  left:50%;
  bottom:calc(var(--footer-total-height) + 14px);
  top:auto;
  width:min(760px,calc(100vw - 24px));
  max-height:70vh;
  background:linear-gradient(to bottom,var(--toc-parchment) 0%,rgba(243,240,234,1) 100%);
  border:1px solid rgba(44,62,80,.16);
  border-top-color:rgba(44,62,80,.18);
  box-shadow:0 22px 60px rgba(0,0,0,.26),0 8px 24px rgba(0,0,0,.14),inset 0 18px 22px -22px rgba(0,0,0,.42);
  border-radius:16px 16px 0 0;
  z-index:1401;
  opacity:0;
  transform:translateX(-50%) translateY(10px);
  transform-origin:50% 100%;
  transition:transform 300ms var(--toc-scroll-ease),opacity var(--toc-scroll-opacity-in) ease;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  background-clip:padding-box;
}

.toc-panel.is-open{opacity:1;transform:translateX(-50%) translateY(0)}
.toc-panel.is-closing{opacity:1;transform:translateX(-50%) translateY(0);pointer-events:none;--toc-scroll-duration:var(--toc-scroll-close-duration)}
.toc-panel[aria-hidden="true"]{pointer-events:none}
.toc-panel[aria-hidden="false"]{pointer-events:auto}

/* Inner veil (subtle), to fuse “black glass” with parchment. */
.toc-panel::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,0) 0%,rgba(0,0,0,0) 58%,rgba(0,0,0,.012) 74%,rgba(0,0,0,.060) 100%);pointer-events:none;z-index:3}

/* -------------------------------------------------
   Header + produced title
   ------------------------------------------------- */

.toc-panel-header{position:relative;z-index:4;padding:.95rem 1.35rem .82rem;border-bottom:1px solid rgba(44,62,80,.12);background:linear-gradient(to bottom,rgba(255,255,255,.52),rgba(255,255,255,.16))}
.toc-produced{min-height:1.15rem}
.toc-produced-title{font-family:'Cormorant Garamond',serif;font-size:1.05rem;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps;line-height:1.25;color:rgba(44,62,80,.88);text-shadow:0 1px 0 rgba(255,255,255,.22);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:7.2rem}

/* -------------------------------------------------
   Hold-to-enter button
   ------------------------------------------------- */

.toc-confirm-btn{
  position:absolute;
  top:12px;
  right:12px;
  z-index:5;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:.42rem .82rem;
  border-radius:999px;
  border:1px solid rgba(44,62,80,.16);
  border-bottom-color:rgba(44,62,80,.24);
  background:
    conic-gradient(from 270deg, rgba(201,169,97,.92) calc(var(--toc-hold-p, 0) * 360deg), rgba(201,169,97,0) 0),
    linear-gradient(to bottom,rgba(255,255,255,.62),rgba(255,255,255,.18));
  font-family:'Cormorant Garamond',serif;
  font-size:.90rem;
  font-weight:650;
  letter-spacing:.14em;
  font-variant-caps:all-small-caps;
  color:var(--toc-ink-soft);
  box-shadow:0 1px 0 rgba(255,255,255,.35),0 10px 20px rgba(0,0,0,.06);
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
}

.toc-confirm-btn:focus-visible{outline:2px solid rgba(201,169,97,.38);outline-offset:4px}
.toc-confirm-btn:disabled{opacity:.52;cursor:default}
.toc-confirm-btn.is-holding{color:rgba(44,62,80,.92)}

/* -------------------------------------------------
   Body
   ------------------------------------------------- */

.toc-panel-body{flex:1;overflow-y:auto;overflow-x:hidden;padding:1.1rem 1.35rem 1.25rem;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;touch-action:pan-y;position:relative}
.toc-panel.has-pending .toc-panel-body{padding-top:2.65rem}

.toc-panel-body::before{content:'';position:absolute;inset:0;background:radial-gradient(900px 420px at 50% 0%,rgba(201,169,97,.06),rgba(201,169,97,0) 55%),radial-gradient(900px 520px at 50% 120%,rgba(0,0,0,.05),rgba(0,0,0,0) 60%),linear-gradient(to bottom,var(--toc-parchment-hi),rgba(255,255,255,0));pointer-events:none}
@supports (-webkit-touch-callout: none){.toc-panel-body::before{display:none}}

.toc-panel-body>*{position:relative}

/* -------------------------------------------------
   Index structure
   ------------------------------------------------- */

.toc-index{position:relative;color:var(--toc-ink)}
.toc-index::before{content:'';position:absolute;top:.3rem;bottom:2.9rem;left:var(--toc-rule-x);width:1px;background:linear-gradient(to bottom,transparent 0%,var(--toc-rule) 10%,var(--toc-rule) 90%,transparent 100%);box-shadow:0 0 0 1px rgba(255,255,255,.18);pointer-events:none}

.toc-group + .toc-group{margin-top:1.05rem;padding-top:.95rem;border-top:1px solid rgba(44,62,80,.14)}
.toc-group-title{margin:0 0 .6rem 0;padding-left:1.65rem}

.toc-tab{display:inline-block;position:relative;font-family:'Cormorant Garamond',serif;font-size:.92rem;font-weight:650;letter-spacing:.18em;font-variant-caps:all-small-caps;color:rgba(44,62,80,.84);text-shadow:0 1px 0 rgba(255,255,255,.22)}
.toc-tab::after{content:'';display:block;margin-top:.32rem;height:1px;width:min(220px,72vw);background:linear-gradient(to right,rgba(139,115,85,.62),rgba(139,115,85,.28),rgba(139,115,85,0));border-radius:999px}

.toc-list{list-style:none;max-width:100%;padding:0;margin:0}
.toc-item{margin:0 0 .42rem;display:block;max-width:100%;position:relative}

.toc-item::before{content:'';position:absolute;left:calc(var(--toc-rule-x) - (var(--toc-node) / 2));top:calc(var(--toc-item-pad-y) + (1em * var(--toc-item-line) / 2));transform:translateY(-50%);width:var(--toc-node);height:var(--toc-node);border-radius:999px;background:rgba(247,244,238,.98);border:1px solid rgba(139,115,85,.66);box-shadow:0 0 0 1px rgba(255,255,255,.22),0 10px 14px rgba(0,0,0,.04);pointer-events:none}

.toc-item--current::before{background:radial-gradient(circle at 50% 50%,rgba(139,115,85,.86) 0 3px,rgba(139,115,85,0) 3.5px),rgba(247,244,238,1);border-color:rgba(139,115,85,.78);box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 18px rgba(201,169,97,.12),0 10px 14px rgba(0,0,0,.04)}

.toc-item--pending::before{background:radial-gradient(circle at 50% 50%,rgba(139,0,0,.88) 0 3px,rgba(139,0,0,0) 3.5px),rgba(247,244,238,1);border-color:rgba(139,0,0,.62);box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 18px rgba(139,0,0,.08),0 10px 14px rgba(0,0,0,.04)}

.toc-item--locked::before{left:calc(var(--toc-rule-x) - (var(--toc-node-locked) / 2));width:var(--toc-node-locked);height:var(--toc-node-locked);background:rgba(247,244,238,.96);border:1px dashed rgba(201,169,97,.56);box-shadow:0 0 0 1px rgba(255,255,255,.18)}

.toc-gate{list-style:none;position:relative;height:16px;margin:.25rem 0 .62rem}
.toc-gate::before{content:'';position:absolute;left:var(--toc-rule-x);right:.2rem;top:50%;transform:translateY(calc(-50% - 2px));height:1px;border-radius:999px;background:linear-gradient(to right,rgba(139,0,0,1),rgba(139,0,0,.22),rgba(139,0,0,0));opacity:1}
.toc-gate::after{content:'✦';position:absolute;left:var(--toc-rule-x);top:50%;transform:translate(-50%,-50%);font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;font-size:12px;line-height:1;color:#8b0000;text-shadow:0 1px 0 rgba(255,255,255,.26),0 10px 16px rgba(0,0,0,.08);pointer-events:none}

.toc-item-btn,.toc-locked-btn{display:block;width:100%;background:none;border:0;padding:var(--toc-item-pad-y) 0 var(--toc-item-pad-y) 1.65rem;margin:0;font:inherit;font-size:1rem;line-height:var(--toc-item-line);text-align:left;white-space:normal;overflow-wrap:anywhere}

.toc-entry{display:flex;gap:.7rem;align-items:baseline;min-width:0}
.toc-entry-key{flex:0 0 auto;min-width:7.9rem;font-family:'Cormorant Garamond',serif;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps;color:var(--toc-ink-soft)}
.toc-entry-title{flex:1 1 auto;min-width:0;color:var(--toc-ink)}

.toc-item-btn{cursor:pointer;transition:color 200ms ease}
.toc-item-btn:hover .toc-entry-title,.toc-item-btn:focus-visible .toc-entry-title{color:#111;text-decoration:underline;text-decoration-color:rgba(139,115,85,.55);text-decoration-thickness:1px;text-underline-offset:3px}
.toc-item-btn:focus-visible{outline:2px solid rgba(201,169,97,.38);outline-offset:3px}

.toc-item--current .toc-entry-title{font-weight:600;color:#111}
.toc-item--current .toc-entry-key{color:rgba(44,62,80,.86)}

.toc-item--pending .toc-entry-title{color:#111;text-decoration:underline;text-decoration-color:rgba(139,0,0,.46);text-decoration-thickness:1px;text-underline-offset:3px}

.toc-locked-btn{color:rgba(120,120,120,.94);opacity:.80;cursor:not-allowed;position:relative}
.toc-locked-btn:focus-visible{outline:2px solid rgba(201,169,97,.26);outline-offset:3px}
.toc-item--locked .toc-entry-key{color:rgba(120,120,120,.62)}
.toc-item--locked .toc-entry-title{color:rgba(120,120,120,.86)}

/* Annex: Lexicon */
.toc-annex{margin-top:1.05rem;padding-top:.95rem;border-top:1px solid rgba(44,62,80,.14)}
.toc-annex-link{display:inline-flex;align-items:baseline;gap:.6rem;padding:.4rem .2rem .2rem 1.65rem;text-decoration:none;color:var(--toc-ink-soft);transition:color 200ms ease}
.toc-annex-link:hover,.toc-annex-link:focus-visible{color:#111;text-decoration:underline;text-decoration-color:rgba(139,115,85,.55);text-decoration-thickness:1px;text-underline-offset:3px}
.toc-annex-link:focus-visible{outline:2px solid rgba(201,169,97,.30);outline-offset:4px}
.toc-annex-sigil{font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;color:rgba(139,115,85,.62)}
.toc-annex-text{font-family:'Cormorant Garamond',serif;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps}

/* Locked feedback (touch-safe) */
.toc-toast{position:sticky;bottom:.65rem;margin:.95rem auto 0;width:fit-content;max-width:min(520px,92%);padding:.6rem 1rem;border-radius:999px;background:rgba(11,12,14,.92);color:rgba(245,245,240,.96);font-size:.95rem;letter-spacing:.04em;line-height:1.25;text-align:center;box-shadow:0 14px 30px rgba(0,0,0,.22),0 2px 10px rgba(0,0,0,.12);opacity:0;transform:translateY(6px);pointer-events:none;transition:opacity 420ms ease,transform 180ms ease}
.toc-toast.is-visible{opacity:1;transform:translateY(0)}

@media (prefers-reduced-motion: reduce){
  :root{--toc-scroll-open-duration:1ms;--toc-scroll-close-duration:1ms;--toc-scroll-duration:1ms;--toc-scroll-opacity-in:1ms}
  .toc-overlay{transition:none}
  .toc-panel{transition:opacity 160ms ease !important;transform:translateX(-50%) !important}
  .toc-toast{transition:none;transform:none}
  .toc-toast.is-visible{transform:none}
}

@media (max-width:600px){
  :root{
    --toc-rule-x:.75rem;
    --toc-node:10px;
    --toc-node-locked:8px;

    --toc-seal-size:38px;
    --toc-seal-width:44px;
    --toc-seal-top-radius:5px;
  }
  .toc-panel{width:calc(100vw - 18px);border-radius:14px 14px 0 0}
  .toc-panel-header{padding:.9rem 1.1rem .78rem}
  .toc-produced-title{font-size:1.0rem}
  .toc-panel-body{padding:1.0rem 1.1rem 1.05rem}
  .toc-panel.has-pending .toc-panel-body{padding-top:2.45rem}
  .toc-group-title,.toc-item-btn,.toc-locked-btn,.toc-annex-link{padding-left:1.45rem}
  .toc-entry-key{min-width:6.9rem}
  .toc-tab::after{width:min(210px,74vw)}
}
