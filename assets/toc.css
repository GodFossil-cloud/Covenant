/*! Covenant ToC Panel Styles v3.1.93 (Pending wash uses soft lamp shade) */

/* -------------------------------------------------
   Variables
   ------------------------------------------------- */

:root{
  --toc-scroll-open-duration:520ms;
  --toc-scroll-close-duration:320ms;
  --toc-scroll-duration:var(--toc-scroll-open-duration);
  --toc-scroll-ease:cubic-bezier(.22,.61,.36,1);
  --toc-scroll-opacity-in:140ms;

  --toc-ink:rgba(44,62,80,.92);
  --toc-ink-soft:rgba(44,62,80,.74);
  --toc-rule:rgba(139,115,85,.26);
  --toc-rule-strong:rgba(139,115,85,.36);

  /* Binding rule below the gate: soft light blue (above-gate binding remains red). */
  --toc-rule-below:rgba(115,170,235,.45);

  --toc-parchment:rgba(247,244,238,1);
  --toc-parchment-hi:rgba(255,255,255,.72);

  --toc-brass:rgba(201,169,97,1);

  /* Pending/armed color (warm violet). Use rgba(var(--toc-armed-rgb), <alpha>). */
  --toc-armed-rgb:178,110,232;

  /* Pending wash shade (lamp-shade): a soft light tone that does NOT affect the violet node/underline. */
  --toc-pending-wash-rgb:245,242,255;

  --toc-rule-x:.95rem;
  --toc-node-x-nudge:-0.5px;
  --toc-node:10px;
  --toc-node-locked:8px;
  --toc-item-pad-y:.26rem;
  --toc-item-line:1.55;

  /* Pending selection: title effect knobs.
     Staged = partial hairline + soft halo; Confirm = line completes + halo strengthens. */
  --toc-pending-title-underline-w:44%;
  --toc-confirm-title-underline-w:100%;

  /* Footer tabs (ToC + Mirror) live beside the Lexicon seal, but do not use the Lexicon "center" medallion styling. */
  --toc-tab-width:calc(var(--nav-pill-width,56px) + 4px);
  --toc-tab-height:var(--nav-pill-height,40px);
  --toc-tab-radius:4px;
  --toc-tab-gap:15px;

  /* Socket geometry should follow the ORIGINAL dock-tab width.
     Visual tab width can overhang by a hair without changing the cradle cutouts. */
  --dock-tab-width:calc(var(--toc-tab-width) - 4px);
  --dock-tab-width-visual:calc(var(--dock-tab-width) + 2px);

  /* Micro spacing: move only the tabs outward from center (do not move sockets). */
  --toc-tab-x-nudge:-1px;
  --mirror-tab-x-nudge:1px;

  --dock-tab-height:calc(var(--toc-tab-height) + 2px);

  /* Visual resize: tabs are 2px shorter, but their TOP EDGE must not move.
     (Because the dock tabs are align-self:center, shrinking height by 2px would normally drop the top edge by 1px,
      so we lift the whole tab by 1px via a shared carry.)

     IMPORTANT: keep this an integer pixel to avoid device-pixel rounding reading as a 1px "proud" seat. */
  --dock-tab-height-visual:calc(var(--dock-tab-height) - 2px);
  --dock-tab-top-edge-lock:-1px;

  /* Per-tab top edge lock.
     Lets the active (welded) tab align to its panel without disturbing the other tab's dock seat. */
  --toc-tab-top-edge-lock:var(--dock-tab-top-edge-lock);
  --mirror-tab-top-edge-lock:var(--dock-tab-top-edge-lock);

  /* Socket cutouts must stay seated in the dock slab (tabs can rise above). */
  --dock-socket-height:calc(var(--toc-tab-height) - 4px);

  /* Sharpen the top corners only; keep bottom corners seated and round. */
  --dock-tab-radius-top:var(--toc-tab-radius);

  /* Dock tab face base tone is defined in assets/footer-overrides.css; toc.css only consumes it. */

  /* Vertical lift so dock tabs rise noticeably above the dock slab. */
  --dock-tab-raise:-31px;

  /* Socket stays closer to the dock baseline so it reads as a true recess. */
  --dock-socket-raise:-2px;

  /* Socket tuning: push the two cradles slightly outward from the center seal, and lift them so their top edge meets the footer slab top. */
  --dock-socket-spread:6px;
  --dock-socket-y-nudge:-6px;

  /* Space between sheet bottom and footer top (0 = flush). */
  --toc-panel-gap:0px;

  /* Optional: reserve a little top breathing-room when computing max height in JS. */
  --toc-top-safe:env(safe-area-inset-top, 0px);

  /* Drag start: keep the fully-closed sheet seated at the dock baseline. */
  --toc-closed-offset:0px;

  /* Fully-open lift: nudge the sheet 1px higher (JS drag math matches this baseline). */
  --toc-open-lift:0px;

  /* Drag snap timing (should match JS SNAP_MS constant). */
  --toc-snap-duration:420ms;
  --toc-snap-ease:cubic-bezier(.22,.61,.36,1);

  /* Dock tab medallion-cap (decorative; does not change the functional welded tab box). */
  --dock-cap-size:var(--dock-tab-width-visual);
  --dock-cap-h:calc(var(--dock-cap-size) / 2);
  --dock-cap-lift:10px;
  --dock-cap-half:calc(var(--dock-cap-h) / 2);

  /* Socket cradle geometry: true semicircle tracing the lower half of the socket.
     IMPORTANT: keep socket geometry independent of the medallion cap size. */
  --dock-socket-d:calc(var(--dock-tab-width) + 2px);
  --dock-socket-r:calc(var(--dock-socket-d) / 2);
  --dock-socket-h:var(--dock-socket-r);

  /* Cradle border only: make the permanent socket cradle 2px taller than the window mask.
     (Lets the top edge fully cover the footer slab hairline in the closed state.) */
  --dock-cradle-h:calc(var(--dock-socket-h) + 0px);

  /* ToC header connector geometry.
     IMPORTANT: notch width must match the *visual* tab width so the opened sheet meets the tab edges cleanly. */
  --toc-notch-w:var(--dock-tab-width-visual);
  --toc-notch-h:calc(var(--dock-tab-height, 42px) - 14px);
  --toc-seat-overlap:2px;

  /* Seat welding: JS seats the tab box using (seat-dy + seat-overlap).
     Tune so the tab TOP edge meets the panel TOP edge; notch/cap remain visual. */
  --toc-seat-dy:calc(var(--dock-tab-height) - var(--toc-seat-overlap));

  /* Tab weld micro-nudge to eliminate hairline seams from fractional pixel rounding during motion.
     NOTE: JS may temporarily override this root variable during close motion. */
  --toc-tab-weld-nudge:0px;

  /* Dock cradle glow lives INSIDE the socket only (never over the footer slab). */
  --dock-socket-glow-toc:
    inset 0 0 22px rgba(236,246,255,0.20),
    inset 0 0 36px rgba(150,195,255,0.10);

  --dock-socket-glow-mirror:
    inset 0 0 22px rgba(255,110,130,0.16),
    inset 0 0 36px rgba(190,90,220,0.10);

  /* Resting cradle glow (subtle, always-on). */
  --dock-socket-glow-toc-rest:
    inset 0 0 16px rgba(236,246,255,0.10),
    inset 0 0 30px rgba(150,195,255,0.06);

  --dock-socket-glow-mirror-rest:
    inset 0 0 16px rgba(255,110,130,0.08),
    inset 0 0 30px rgba(190,90,220,0.05);
}

/* iOS Safari: when the sheet is committed open (or opening), a +1px weld keeps the tab from
   reading "proud" (slightly higher) than the panel edge due to subpixel rounding.
   IMPORTANT: During close motion, JS cancels this weld with a matching -1px carry so the tab
   does not visibly re-target transform mid-flight. */
html.toc-opening,
html.toc-open{--toc-tab-weld-nudge:1px}

/* While a panel is open (or opening), drop the top-edge-lock so the active tab can meet its panel.
   IMPORTANT: During closing, restore the lock so there is no last-frame 1px "drop then pop" when
   root motion classes are cleaned up. */
html.toc-opening,
html.toc-open{--toc-tab-top-edge-lock:0px}
html.toc-closing{--toc-tab-top-edge-lock:var(--dock-tab-top-edge-lock)}

html.reliquary-opening,
html.reliquary-open{--mirror-tab-top-edge-lock:0px}
html.reliquary-closing{--mirror-tab-top-edge-lock:var(--dock-tab-top-edge-lock)}

/* -------------------------------------------------
   Scroll lock
   ------------------------------------------------- */

html.toc-scroll-lock{overflow:hidden;height:100%}
html.toc-scroll-lock body{overflow:hidden;height:100%}

/* -------------------------------------------------
   Modal veil
   ------------------------------------------------- */

.toc-overlay{position:fixed;inset:0 0 var(--toc-footer-reserved, var(--footer-total-height)) 0;background:rgba(0,0,0,.72);z-index:1400;opacity:0;pointer-events:none;transition:opacity 340ms var(--toc-scroll-ease)}
.toc-overlay.is-open{opacity:1;pointer-events:auto}

@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))){
  .toc-overlay{-webkit-backdrop-filter:blur(0px);backdrop-filter:blur(0px)}
  .toc-overlay.is-open{-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}
}

/* -------------------------------------------------
   Panel (anchored above footer)
   ------------------------------------------------- */

.toc-panel{
  position:fixed;
  left:50%;
  bottom:calc(var(--toc-footer-reserved, var(--footer-total-height)) + var(--toc-panel-gap, 0px));
  top:auto;
  width:min(760px,calc(100vw - 24px));
  max-height:70vh;
  background:linear-gradient(to bottom,var(--toc-parchment) 0%,rgba(243,240,234,1) 100%);
  border:1px solid rgba(44,62,80,.16);
  border-top-color:rgba(44,62,80,.18);
  box-shadow:0 22px 60px rgba(0,0,0,.26),0 8px 24px rgba(0,0,0,.14),inset 0 18px 22px -22px rgba(0,0,0,.42);
  border-radius:16px 0 0 0;
  z-index:1401;
  opacity:0;
  --toc-panel-x:-50%;
  transform:translateX(var(--toc-panel-x)) translateY(10px);
  transform-origin:50% 100%;
  transition:transform 300ms var(--toc-scroll-ease),opacity var(--toc-scroll-opacity-in) ease;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  background-clip:padding-box;
}

.toc-panel.is-open{opacity:1;transform:translateX(var(--toc-panel-x)) translateY(var(--toc-open-lift, 0px))}
.toc-panel.is-closing{opacity:1;transform:translateX(var(--toc-panel-x)) translateY(var(--toc-open-lift, 0px));pointer-events:none;--toc-scroll-duration:var(--toc-scroll-close-duration)}
.toc-panel[aria-hidden="true"]{pointer-events:none}
.toc-panel[aria-hidden="false"]{pointer-events:auto}

.toc-panel.is-dragging{transition:none !important}

/* When the ToC is open, follow the tab's cradle nudge by shifting the panel (not the tab).
   This preserves dock socket alignment while eliminating the outer-edge 1px overhang on the sheet. */
@media (min-width:601px){
  html.toc-opening .toc-panel,
  html.toc-open .toc-panel,
  html.toc-closing .toc-panel{--toc-panel-x:calc(-50% + var(--toc-tab-x-nudge, 0px))}
}

.toc-panel::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,0) 0%,rgba(0,0,0,0) 58%,rgba(0,0,0,.012) 74%,rgba(0,0,0,.060) 100%);pointer-events:none;z-index:3}

/* -------------------------------------------------
   Drag handle region (sheet-style)
   ------------------------------------------------- */

.toc-drag-region{
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:22px;
  z-index:10;
  cursor:ns-resize;
  display:flex;
  align-items:center;
  justify-content:center;
  -webkit-tap-highlight-color:transparent;
  touch-action:none;
  user-select:none;
  -webkit-user-select:none;
}

.toc-drag-region::before{
  content:'';
  width:48px;
  height:4px;
  border-radius:999px;
  background:rgba(255,255,255,.22);
  box-shadow:0 1px 0 rgba(0,0,0,.55);
}

/* -------------------------------------------------
   Header + connector strip
   ------------------------------------------------- */

/* Match Reliquary header sizing so both veils feel like the same instrument family. */
.toc-panel-header{position:relative;z-index:4;padding:.95rem 1.25rem .78rem;min-height:3.05rem;border-bottom:1px solid rgba(0,0,0,.62);background:var(--dock-tab-face,#010103)}

/* Persistent connector strip: visible regardless of root motion classes. */
.toc-panel-header::after{
  content:'';
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:var(--toc-notch-w);

  /* Darker connector strip so the cutout reads as an intentional socket. */
  background:
    linear-gradient(to bottom,
      rgba(232,228,220,.96) 0%,
      rgba(222,217,208,.86) 52%,
      rgba(214,209,200,.78) 100%);

  border-right:1px solid rgba(44,62,80,.14);
  box-shadow:
    inset -10px 0 14px -14px rgba(0,0,0,.28),
    inset -1px 0 0 rgba(0,0,0,.06);

  pointer-events:none;
  z-index:0;
  opacity:1;
}

.toc-produced{min-height:1.15rem}
.toc-produced-title{font-family:'Cormorant Garamond',serif;font-size:1.05rem;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps;line-height:1.25;color:rgba(44,62,80,.88);text-shadow:0 1px 0 rgba(255,255,255,.22);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

html.toc-opening .toc-produced,
html.toc-open .toc-produced,
html.toc-closing .toc-produced,
html.toc-dock-settling .toc-produced{position:relative;z-index:1}

html.toc-opening .toc-produced-title,
html.toc-open .toc-produced-title,
html.toc-closing .toc-produced-title,
html.toc-dock-settling .toc-produced-title{padding-left:calc(var(--toc-notch-w) + .9rem)}

/* -------------------------------------------------
   Body
   ------------------------------------------------- */

.toc-panel-body{flex:1;overflow-y:auto;overflow-x:hidden;padding:1.1rem 1.35rem 1.25rem;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;touch-action:pan-y;position:relative}

.toc-panel-body::before{content:'';position:absolute;inset:0;background:radial-gradient(900px 420px at 50% 0%,rgba(201,169,97,.06),rgba(201,169,97,0) 55%),radial-gradient(900px 520px at 50% 120%,rgba(0,0,0,.05),rgba(0,0,0,0) 60%),linear-gradient(to bottom,var(--toc-parchment-hi),rgba(255,255,255,0));pointer-events:none}
@supports (-webkit-touch-callout: none){.toc-panel-body::before{display:none}}

.toc-panel-body>*{position:relative}

/* -------------------------------------------------
   Index structure
   ------------------------------------------------- */

.toc-index{position:relative;color:var(--toc-ink);--toc-gate-y:0px;--toc-gate-cut:max(0px, calc(var(--toc-gate-y, 0px) - .3rem));isolation:isolate}
.toc-index::before{content:'';position:absolute;top:.3rem;bottom:2.9rem;left:var(--toc-rule-x);width:1px;background-image:linear-gradient(to bottom,transparent 0%,var(--toc-rule) 10%,var(--toc-rule) 90%,transparent 100%),linear-gradient(to bottom,var(--toc-rule-below, rgba(115,170,235,.45)) 0%,var(--toc-rule-below, rgba(115,170,235,.45)) 90%,transparent 100%);background-repeat:no-repeat;background-size:1px var(--toc-gate-cut),1px calc(100% - var(--toc-gate-cut));background-position:0 0,0 var(--toc-gate-cut);box-shadow:0 0 0 1px rgba(255,255,255,.18);pointer-events:none;z-index:0}

/* Binding ABOVE the gate: match the gate divider + ✦ marker; below remains the default rule. */
.toc-index::after{content:'';position:absolute;top:.3rem;left:var(--toc-rule-x);width:1px;height:max(0px, calc(var(--toc-gate-y, 0px) - .3rem));background:linear-gradient(to bottom,transparent 0%,rgba(139,0,0,1) 10%,rgba(139,0,0,1) 90%,transparent 100%);box-shadow:0 0 0 1px rgba(255,255,255,.18);pointer-events:none;z-index:0}

.toc-index .toc-list,
.toc-index .toc-annex{position:relative;z-index:1}

.toc-group + .toc-group{margin-top:1.05rem;padding-top:.95rem;border-top:1px solid rgba(44,62,80,.14)}
.toc-group-title{margin:0 0 .6rem 0;padding-left:1.65rem}

.toc-tab{display:inline-block;position:relative;font-family:'Cormorant Garamond',serif;font-size:.92rem;font-weight:650;letter-spacing:.18em;font-variant-caps:all-small-caps;color:rgba(44,62,80,.84);text-shadow:0 1px 0 rgba(255,255,255,.22)}
.toc-tab::after{content:'';display:block;margin-top:.32rem;height:1px;width:min(220px,72vw);background:linear-gradient(to right,
      rgba(139,115,85,.62),
      rgba(139,115,85,.28),
      rgba(139,115,85,0));border-radius:999px}

.toc-list{list-style:none;max-width:100%;padding:0;margin:0}
.toc-item{margin:0 0 .42rem;display:block;max-width:100%;position:relative;z-index:1}

/* Node indicators: restore empty circles for every entry so the binding reads like a stitched track.
   Current + pending are then marked within that same track. */
.toc-item::before{
  content:'';
  display:block;
  position:absolute;
  left:calc(var(--toc-rule-x) - (var(--toc-node) / 2) + var(--toc-node-x-nudge, 0px));
  top:calc(var(--toc-item-pad-y) + (1em * var(--toc-item-line) / 2));
  transform:translateY(-50%);
  width:var(--toc-node);
  height:var(--toc-node);
  border-radius:999px;
  background:var(--toc-parchment);
  border:1px solid rgba(139,115,85,.34);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.18),0 10px 14px rgba(0,0,0,.03);
  pointer-events:none;
  opacity:.92;
  z-index:2;
}

/* Locked nodes: smaller + ashen (clear "not yet").
   IMPORTANT: do not lower opacity on the whole dot, or the binding rule will bleed through the fill. */
.toc-item--locked::before{
  left:calc(var(--toc-rule-x) - (var(--toc-node-locked) / 2) + var(--toc-node-x-nudge, 0px));
  width:var(--toc-node-locked);
  height:var(--toc-node-locked);
  background:var(--toc-parchment);
  border-color:rgba(24,36,52,.20);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.10);
}

/* Sealed nodes AFTER gate: colder + more hollow (but keep the fill opaque so the rule can't show through). */
.toc-gate ~ .toc-item--locked::before{
  border-color:rgba(24,36,52,.14);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
}

/* Current + pending nodes: distinct. */
.toc-item--current::before{background:radial-gradient(circle at 50% 50%,rgba(139,115,85,.86) 0 3px,rgba(139,115,85,0) 3.5px),rgba(247,244,238,1);border-color:rgba(139,115,85,.78);box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 18px rgba(201,169,97,.12),0 10px 14px rgba(0,0,0,.04);opacity:1}

.toc-item--pending:not(.toc-item--current):not([aria-current="page"])::before{background:radial-gradient(circle at 50% 50%,rgba(var(--toc-armed-rgb),.92) 0 3px,rgba(var(--toc-armed-rgb),0) 3.5px),rgba(247,244,238,1);border-color:rgba(var(--toc-armed-rgb),.70);box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 18px rgba(var(--toc-armed-rgb),.14),0 10px 14px rgba(0,0,0,.04);opacity:1}

.toc-gate{list-style:none;position:relative;height:16px;margin:.35rem 0 .78rem}
.toc-gate::before{content:'';position:absolute;left:var(--toc-rule-x);right:.2rem;top:calc(50% - 1.5px);transform:translateY(-50%);height:1.35px;border-radius:999px;background:linear-gradient(to right,rgba(0,0,0,1),rgba(0,0,0,.22),rgba(0,0,0,0));opacity:1}
.toc-gate::after{content:'✦';position:absolute;left:calc(var(--toc-rule-x) + 0.2px);top:50%;transform:translate(-50%,-50%);font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;font-size:12px;line-height:1;color:#000;text-shadow:0 1px 0 rgba(255,255,255,.26),0 10px 16px rgba(0,0,0,.08);pointer-events:none}

.toc-item-btn,.toc-locked-btn{display:block;width:100%;background:none;border:0;padding:var(--toc-item-pad-y) 0 var(--toc-item-pad-y) 1.65rem;margin:0;font:inherit;font-size:1rem;line-height:var(--toc-item-line);text-align:left;white-space:normal;overflow-wrap:anywhere}

.toc-entry{display:flex;gap:.7rem;align-items:baseline;min-width:0}
.toc-entry-key{flex:0 0 auto;min-width:7.9rem;font-family:'Cormorant Garamond',serif;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps;color:var(--toc-ink-soft)}
.toc-entry-title{flex:1 1 auto;min-width:0;color:var(--toc-ink)}

.toc-item-btn{cursor:pointer;transition:color 200ms ease}

/* IMPORTANT: JS focuses the first item on open, so do not underline on focus-visible. */
.toc-item-btn:hover .toc-entry-title{color:#111;text-decoration:none}
.toc-item-btn:focus-visible .toc-entry-title{color:#111;text-decoration:none}

.toc-item-btn:focus-visible{outline:2px solid rgba(201,169,97,.38);outline-offset:3px}

.toc-item--current .toc-entry-title{font-weight:600;color:#111}
.toc-item--current .toc-entry-key{color:rgba(44,62,80,.86)}

/* Pending entries: keep the node brass (left dot). */
.toc-item--pending .toc-entry-title{color:#111}

/* Pending entries already render a deliberate lantern wash.
   Suppress the generic hover/focus underline so it does not double up. */
.toc-item--pending .toc-item-btn:hover .toc-entry-title,
.toc-item--pending .toc-item-btn:focus-visible .toc-entry-title{text-decoration:none}

/* Sealed entries: ashen slate (diluted ink) rather than "disabled gray".
   Slightly colder (blue-leaning) so sealed territory reads distinct from the warm unlocked track. */
.toc-locked-btn{color:rgba(38,54,72,.58);opacity:.68;cursor:not-allowed;position:relative}
.toc-locked-btn:focus-visible{outline:2px solid rgba(201,169,97,.26);outline-offset:3px}

.toc-item--locked .toc-entry-key{color:rgba(38,54,72,.40)}
.toc-item--locked .toc-entry-title{color:rgba(38,54,72,.54)}

/* -------------------------------------------------
   Sealed boundary
   ------------------------------------------------- */

/* Sealed region: cool wash behind locked entries AFTER the gate. */
.toc-gate ~ .toc-item--locked .toc-locked-btn{
  position:relative;
  isolation:isolate;
  opacity:.54;
  color:rgba(24,36,52,.55);
}

.toc-gate ~ .toc-item--locked .toc-entry-key{color:rgba(24,36,52,.40)}
.toc-gate ~ .toc-item--locked .toc-entry-title{color:rgba(24,36,52,.54)}

.toc-gate ~ .toc-item--locked .toc-locked-btn::after{
  content:'';
  position:absolute;
  top:-6px;
  bottom:-6px;
  left:1.05rem;
  right:.25rem;

  border-radius:16px;
  filter:blur(7px);

  background:
    radial-gradient(85% 260% at 0% 55%, rgba(200,220,255,.12) 0%, rgba(200,220,255,0) 62%),
    radial-gradient(110% 300% at 55% 55%, rgba(160,190,235,.06) 0%, rgba(160,190,235,0) 70%),
    linear-gradient(to right, rgba(255,255,255,.05), rgba(255,255,255,0) 56%);

  opacity:.75;
  pointer-events:none;
  z-index:0;
}

.toc-gate ~ .toc-item--locked .toc-locked-btn > *{position:relative;z-index:1}

.toc-annex{margin-top:1.05rem;padding-top:.95rem;border-top:1px solid rgba(44,62,80,.14)}
.toc-annex-link{display:inline-flex;align-items:baseline;gap:.6rem;padding:.4rem .2rem .2rem 1.65rem;text-decoration:none;color:var(--toc-ink-soft);transition:color 200ms ease}
.toc-annex-link:hover,.toc-annex-link:focus-visible{color:#111;text-decoration:underline;text-decoration-color:rgba(139,115,85,.55);text-decoration-thickness:1px;text-underline-offset:3px}
.toc-annex-link:focus-visible{outline:2px solid rgba(201,169,97,.30);outline-offset:4px}
.toc-annex-sigil{font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;color:rgba(139,115,85,.62)}
.toc-annex-text{font-family:'Cormorant Garamond',serif;font-weight:600;letter-spacing:.10em;font-variant-caps:all-small-caps}

.toc-toast{position:sticky;bottom:.65rem;margin:.95rem auto 0;width:fit-content;max-width:min(520px,92%);padding:.6rem 1rem;border-radius:999px;background:rgba(11,12,14,.92);color:rgba(245,245,240,.96);font-size:.95rem;letter-spacing:.04em;line-height:1.25;text-align:center;box-shadow:0 14px 30px rgba(0,0,0,.22),0 2px 10px rgba(0,0,0,.12);opacity:0;transform:translateY(6px);pointer-events:none;transition:opacity 420ms ease,transform 180ms ease}
.toc-toast.is-visible{opacity:1;transform:translateY(0)}

/* -------------------------------------------------
   Footer tabs (ToC toggle + mirror)
   ------------------------------------------------- */

/* Strategy B: one centered cluster governs tab symmetry. */
.nav-seals{display:grid;grid-template-columns:var(--toc-tab-width) var(--seal-size) var(--toc-tab-width);column-gap:var(--toc-tab-gap);align-items:center;justify-content:center;min-width:0;position:relative;z-index:3;isolation:isolate}

/* Keep dock controls above any decorative socket layers. */
html .nav-seals > .nav-btn{position:relative;z-index:2}

/* ToC + Mirror socket cradles: permanent dock cutouts that remain even when the tabs are seated. */
.nav-seals::before,
.nav-seals::after{
  content:'';
  position:absolute;
  top:50%;
  width:var(--dock-socket-d);
  height:var(--dock-cradle-h, var(--dock-socket-h));
  transform:translate3d(-50%,calc(-50% + var(--dock-socket-raise) + var(--dock-socket-y-nudge, 0px)),0);

  /* True upward-facing semicircle (open top). */
  border-radius:0 0 var(--dock-socket-r) var(--dock-socket-r);

  /* Keep the border from changing the socket geometry. */
  box-sizing:border-box;

  /* Cut line: U-shape only (no top horizontal rim). */
  border:1px solid rgba(59,54,43,.92);
  border-top:0;

  background:
    /* Sidewall bevels (machining reads at the sides, not the top rim). */
    linear-gradient(to right,
      rgba(255,255,255,.08) 0%,
      rgba(255,255,255,0) 18%,
      rgba(255,255,255,0) 82%,
      rgba(0,0,0,.55) 100%),
    /* Depth body (darker toward the arc floor). */
    radial-gradient(circle farthest-side at 50% 0,
      rgba(0,0,0,.92) 0%,
      rgba(16,16,20,.96) 46%,
      rgba(0,0,0,.985) 100%);

  --dock-socket-glow:inset 0 0 0 rgba(0,0,0,0);

  box-shadow:
    /* Interior depth + faint bottom catch. */
    inset 0 12px 18px rgba(0,0,0,.80),
    inset 0 -10px 14px rgba(255,255,255,.06),
    /* Tiny external lift so the cut reads against the slab. */
    0 1px 0 rgba(255,255,255,.05),
    /* Intent glow (socket-only). */
    var(--dock-socket-glow);

  transition:box-shadow 420ms var(--toc-scroll-ease);

  opacity:1;
  pointer-events:none;
  z-index:1;
}

/* Left socket (ToC tab). */
.nav-seals::before{left:calc(var(--toc-tab-width) / 2 - var(--dock-socket-spread, 0px));--dock-socket-glow:var(--dock-socket-glow-toc-rest)}

/* Right socket (Mirror tab). */
.nav-seals::after{left:calc(100% - (var(--toc-tab-width) / 2) + var(--dock-socket-spread, 0px));--dock-socket-glow:var(--dock-socket-glow-mirror-rest)}

/* If the Lexicon door is open, keep both sockets quiet but present. */
html.lexicon-scroll-lock .nav-seals::before,
html.lexicon-scroll-lock .nav-seals::after{opacity:.45}

/* Socket glow gates (root motion shells) — keep the cradle gradient alive while open, too. */
html.toc-opening .nav-seals::before,
html.toc-open .nav-seals::before,
html.toc-closing .nav-seals::before{--dock-socket-glow:var(--dock-socket-glow-toc)}

html.reliquary-opening .nav-seals::after,
html.reliquary-open .nav-seals::after,
html.reliquary-closing .nav-seals::after,
html.reliquary-dragging .nav-seals::after{--dock-socket-glow:var(--dock-socket-glow-mirror)}

/* Socket glow gates (descendant drag states) — progressive enhancement. */
@supports selector(:has(*)){
  .nav-seals:has(#tocToggle.is-toc-dragging)::before{--dock-socket-glow:var(--dock-socket-glow-toc)}
  .nav-seals:has(#mirrorToggle.is-reliquary-dragging)::after{--dock-socket-glow:var(--dock-socket-glow-mirror)}
}

html #tocToggle.dock-tab,
html #mirrorToggle.dock-tab{
  position:relative;
  width:var(--dock-tab-width-visual);
  height:var(--dock-tab-height-visual, var(--dock-tab-height));
  border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) var(--toc-tab-radius) var(--toc-tab-radius);
  padding:0;
  justify-self:center;
  align-self:center;

  /* Quiet interior shadow so the tab feels seated in the dock. */
  box-shadow:inset 0 -12px 16px -16px rgba(0,0,0,.86);
}

/* Decorative: medallion cap on a stem (keeps the welded tab box intact). */
html #tocToggle.dock-tab,
html #mirrorToggle.dock-tab{overflow:visible}

html #tocToggle.dock-tab .dock-cap,
html #mirrorToggle.dock-tab .dock-cap{position:absolute;left:50%;top:0;width:var(--dock-cap-size);height:var(--dock-cap-h);transform:translate3d(-50%,calc(-1 * var(--dock-cap-lift) + (var(--dock-cap-size) - var(--dock-cap-h))),0);border-radius:0 0 999px 999px;overflow:hidden;pointer-events:none;z-index:0}

/* Glyph-only: fully remove the medallion silhouette (rim + fill). */
html #tocToggle.dock-tab .dock-cap::before,
html #mirrorToggle.dock-tab .dock-cap::before{content:none;display:none}

html #tocToggle.dock-tab .dock-cap::after,
html #mirrorToggle.dock-tab .dock-cap::after{content:none;display:none}

html #tocToggle.dock-tab .toc-glyph,
html #mirrorToggle.dock-tab .toc-glyph{position:absolute;left:50%;top:calc(0px - var(--dock-cap-lift) + (var(--dock-cap-size) - var(--dock-cap-h)) + var(--dock-cap-half));transform:translate3d(-50%,-50%,0);z-index:2}

html #tocToggle.dock-tab .toc-glyph{transform:translate3d(-50%,-50%,0) translateY(var(--toc-glyph-nudge-y, 0px))}
html #mirrorToggle.dock-tab .toc-glyph{transform:translate3d(-50%,-50%,0) translateY(var(--mirror-glyph-nudge-y, 0px))}

/* ToC + Mirror tabs ride with their panels (Lexicon-style). */
html #tocToggle.dock-tab{
  transform:translate3d(
    var(--toc-tab-x-nudge, 0px),
    calc(var(--dock-tab-raise) + var(--toc-tab-drag-y, 0px) + var(--toc-tab-weld-nudge, 0px) + var(--toc-tab-top-edge-lock, var(--dock-tab-top-edge-lock, 0px))),
    0);
  transition:transform var(--toc-snap-duration) var(--toc-snap-ease);
  will-change:transform;

  touch-action:none;
  -webkit-tap-highlight-color:transparent;
  user-select:none;
  -webkit-user-select:none;

  cursor:ns-resize;
}

html #mirrorToggle.dock-tab{
  transform:translate3d(
    var(--mirror-tab-x-nudge, 0px),
    calc(var(--dock-tab-raise) + var(--mirror-tab-drag-y, 0px) + var(--mirror-tab-top-edge-lock, var(--dock-tab-top-edge-lock, 0px))),
    0);
  transition:transform var(--reliquary-snap-duration, var(--toc-snap-duration)) var(--reliquary-snap-ease, var(--toc-snap-ease));
  will-change:transform;

  touch-action:none;
  -webkit-tap-highlight-color:transparent;
  user-select:none;
  -webkit-user-select:none;

  cursor:ns-resize;
}

html #tocToggle.dock-tab.is-toc-dragging,
html #mirrorToggle.dock-tab.is-reliquary-dragging{transition:none !important}

/* During dock settling, keep the dock tabs transitionless so the final variable cleanup
   (clearing carry offsets) cannot read as a last-frame "snap". */
html.toc-dock-settling #tocToggle.dock-tab,
html.toc-dock-settling #mirrorToggle.dock-tab{transition:none !important}

/* When ToC + Reliquary are both open, ui-stack hides the background tab so it reads as covered. */
html #tocToggle.dock-tab.is-ui-stack-covered,
html #mirrorToggle.dock-tab.is-ui-stack-covered{opacity:0;visibility:hidden;pointer-events:none}

/* Override the generic "nav-btn:not(.center)" framing (which uses inset:14px). */
html #tocToggle.dock-tab::before,
html #mirrorToggle.dock-tab::before{
  content:'';
  position:absolute;
  inset:0;
  border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) var(--toc-tab-radius) var(--toc-tab-radius);

  border:1px solid rgba(0,0,0,0.72);

  box-shadow:inset 0 0 12px rgba(0,0,0,.95);
  pointer-events:none;
}

html #tocToggle.dock-tab::after,
html #mirrorToggle.dock-tab::after{
  content:'';
  position:absolute;
  inset:0;
  border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) var(--toc-tab-radius) var(--toc-tab-radius);
  z-index:-1;
  pointer-events:none;

  background-color:var(--dock-tab-face, #010103);
  background-image:
    linear-gradient(to bottom, rgba(255, 242, 210, 0.10) 0%, rgba(255, 242, 210, 0) 14px),
    linear-gradient(to bottom, rgba(255, 232, 180, 0.06) 0%, rgba(0, 0, 0, 0.40) 100%);
}

/* Mirror tab: medallion-only (remove welded tab box permanently). */
html #mirrorToggle.dock-tab{box-shadow:none;background:transparent}
html #mirrorToggle.dock-tab::before,
html #mirrorToggle.dock-tab::after{content:none !important;display:none !important}

/* ToC tab: medallion-only (remove welded tab box permanently). */
html #tocToggle.dock-tab{box-shadow:none;background:transparent}
html #tocToggle.dock-tab::before,
html #tocToggle.dock-tab::after{content:none !important;display:none !important}

/* Bigger hit-box for side tabs (no visual change).
   NOTE: bottom expansion stays modest so we do not steal taps from the citation label zone. */
html #tocToggle.dock-tab::before{
  content:'' !important;
  display:block !important;
  position:absolute;
  top:-16px;
  bottom:-8px;
  left:-16px;
  right:-12px;
  background:transparent !important;
  border:0 !important;
  box-shadow:none !important;
  pointer-events:auto;
}

html #mirrorToggle.dock-tab::before{
  content:'' !important;
  display:block !important;
  position:absolute;
  top:-16px;
  bottom:-8px;
  left:-12px;
  right:-16px;
  background:transparent !important;
  border:0 !important;
  box-shadow:none !important;
  pointer-events:auto;
}

/* ToC tab: sharp bottom-left, slightly rounder bottom-right. */
html #tocToggle.dock-tab{border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) 0 0}
html #tocToggle.dock-tab::before{border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) 0 0}
html #tocToggle.dock-tab::after{border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) 0 0}

/* Mirror tab: sharp bottom-right, slightly rounder bottom-left. */
html #mirrorToggle.dock-tab{border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) 0 0}
html #mirrorToggle.dock-tab::before{border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) 0 0}
html #mirrorToggle.dock-tab::after{border-radius:var(--dock-tab-radius-top) var(--dock-tab-radius-top) 0 0}

html #tocToggle.dock-tab:hover::before,
html #tocToggle.dock-tab:focus-visible::before,
html #mirrorToggle.dock-tab:hover::before,
html #mirrorToggle.dock-tab:focus-visible::before{box-shadow:none !important}

html #tocToggle.dock-tab:hover::after,
html #tocToggle.dock-tab:focus-visible::after,
html #mirrorToggle.dock-tab:hover::after,
html #mirrorToggle.dock-tab:focus-visible::after{
  background-image:
    linear-gradient(to bottom, rgba(255, 242, 210, 0.14) 0%, rgba(255, 242, 210, 0) 14px),
    linear-gradient(to bottom, rgba(255, 235, 180, 0.10) 0%, rgba(0, 0, 0, 0.34) 100%);
}

/* Mechanical press: remove iOS touch-down 1px hop (it reads like a dock glitch). */
html #mirrorToggle.dock-tab:active:not(:disabled){
  transform:translate3d(
    var(--mirror-tab-x-nudge, 0px),
    calc(var(--dock-tab-raise) + var(--mirror-tab-drag-y, 0px) + var(--mirror-tab-top-edge-lock, var(--dock-tab-top-edge-lock, 0px))),
    0);
}

/* ToC tab is also a drag handle: remove the 1px :active "jump" at touch-down. */
html #tocToggle.dock-tab:active:not(:disabled){
  transform:translate3d(
    var(--toc-tab-x-nudge, 0px),
    calc(var(--dock-tab-raise) + var(--toc-tab-drag-y, 0px) + var(--toc-tab-weld-nudge, 0px) + var(--toc-tab-top-edge-lock, var(--dock-tab-top-edge-lock, 0px))),
    0);
}

html #tocToggle.dock-tab .toc-glyph,
html #mirrorToggle.dock-tab .toc-glyph{font-family:'Noto Sans Symbols 2','Noto Sans Symbols','Segoe UI Symbol','Apple Symbols',serif;font-size:.86rem;line-height:1;display:inline-block}

/* Dock z-index is already stable via assets/covenant.css (.nav-footer { z-index: 1700 }).
   Do not toggle dock/toggle z-index during toc-opening; iOS Safari can jitter ~1px on compositor re-rasterization. */

/* During settle, ignore hover/pointer churn while the tab is sliding into place (desktop fine pointers only). */
@media (hover: hover) and (pointer: fine){html.toc-closing #tocToggle{pointer-events:none}}

/* -------------------------------------------------
   Footer fade choreography
   ------------------------------------------------- */

html .nav-footer{isolation:isolate;transition:border-top-color 220ms var(--toc-scroll-ease),border-bottom-color 220ms var(--toc-scroll-ease)}
html .nav-footer::before,html .nav-footer::after{transition:opacity 220ms var(--toc-scroll-ease);will-change:opacity}
html #citationLabel{transition:opacity 220ms var(--toc-scroll-ease),visibility 0s linear 0s}

html .nav-footer-inner{position:relative}
html .nav-footer-inner::before{content:'';position:absolute;inset:0;background:rgba(0,0,0,.32);pointer-events:none;z-index:1;opacity:0;transition:opacity 220ms var(--toc-scroll-ease);will-change:opacity}
html .nav-footer-inner > *{position:relative;z-index:2}

html.toc-open .nav-footer,
html.toc-closing .nav-footer,
html.toc-dock-settling .nav-footer{
  border-top-color:rgba(0,0,0,0.70);
  border-bottom-color:rgba(0,0,0,0.92);
}

html.toc-open #citationLabel,
html.toc-closing #citationLabel,
html.toc-dock-settling #citationLabel{
  opacity:1;
  visibility:visible;
  transition:opacity 220ms var(--toc-scroll-ease),visibility 0s linear 0s;
}

html.toc-open .nav-footer::before,
html.toc-closing .nav-footer::before,
html.toc-dock-settling .nav-footer::before{opacity:1}

html.toc-open .nav-footer::after,
html.toc-closing .nav-footer::after,
html.toc-dock-settling .nav-footer::after{opacity:.90}

/* -------------------------------------------------
   Reduced motion
   ------------------------------------------------- */

@media (prefers-reduced-motion: reduce){
  :root{--toc-scroll-open-duration:1ms;--toc-scroll-close-duration:1ms;--toc-scroll-duration:1ms;--toc-scroll-opacity-in:1ms;--toc-snap-duration:1ms}
  .toc-overlay{transition:none}
  .toc-panel{transition:opacity 160ms ease !important;transform:translateX(var(--toc-panel-x)) !important}
  .toc-toast{transition:none;transform:none}
  .toc-toast.is-visible{transform:none}

  .toc-item--pending .toc-item-btn::after,
  .toc-item--pending .toc-item-btn::before,
  .toc-item--pending::before{animation:none !important}
}

/* -------------------------------------------------
   Mobile
   ------------------------------------------------- */

@media (max-width:600px){
  :root{
    --toc-rule-x:.75rem;
    --toc-node:10px;
    --toc-node-locked:8px;
    --dock-tab-raise:-29px;
    --dock-socket-raise:-2px;
    --dock-socket-spread:5px;
    --dock-socket-y-nudge:-6px;
    --toc-tab-gap:14px;
    --dock-cap-size:var(--dock-tab-width-visual);
    --dock-cap-lift:9px;

    --dock-socket-d:calc(var(--dock-tab-width) + 2px);
    --dock-socket-r:calc(var(--dock-socket-d) / 2);
    --dock-socket-h:var(--dock-socket-r);
  }

  .toc-panel{
    --toc-panel-x:0px;
    left:var(--toc-panel-left, 12px);
    right:0;
    width:auto;
    border-radius:0 0 0 0;

    max-height:none;
  }

  /* Mobile Safari: the tab's decorative cap can extend ~1px beyond the button's rect.
     When open, bias the sheet left by 1px so the outer edge never reads "overhanging". */
  html.toc-opening .toc-panel,
  html.toc-open .toc-panel,
  html.toc-closing .toc-panel{left:max(0px, calc(var(--toc-panel-left, 12px) - 1px))}

  .toc-panel-header{padding:.95rem 1.25rem .78rem;min-height:3.05rem}
  .toc-produced-title{font-size:1.0rem}
  .toc-panel-body{padding:1.0rem 1.1rem 1.05rem}
  .toc-group-title,.toc-item-btn,.toc-locked-btn,.toc-annex-link{padding-left:1.45rem}
  .toc-entry-key{min-width:6.9rem}
  .toc-tab::after{width:min(210px,74vw)}
}

/* -------------------------------------------------
   Motion hairline guard
   ------------------------------------------------- */

/* During open/close motion (ToC + Reliquary), suppress the top hairline to avoid stray 1px seams. */
html.toc-opening .nav-footer,
html.toc-closing .nav-footer,
html.reliquary-opening .nav-footer,
html.reliquary-closing .nav-footer{border-top-color:transparent !important}

/* -------------------------------------------------
   ToC header connector strip override
   ------------------------------------------------- */

/* Remove the top-left rectangular connector/notch block. */
.toc-panel-header::after{content:none !important}

/* If a visible title exists, do not reserve space for the removed connector strip. */
html.toc-opening .toc-produced-title,
html.toc-open .toc-produced-title,
html.toc-closing .toc-produced-title,
html.toc-dock-settling .toc-produced-title{padding-left:.9rem !important}

/* -------------------------------------------------
   Touch highlight suppression
   ------------------------------------------------- */

.toc-item-btn,
.toc-locked-btn,
.toc-annex-link{-webkit-tap-highlight-color:transparent}

@media (hover: none), (pointer: coarse){
  .toc-item-btn:focus-visible,
  .toc-locked-btn:focus-visible,
  .toc-annex-link:focus-visible{outline:none}
}

/* -------------------------------------------------
   Pending lantern wash
   ------------------------------------------------- */

@keyframes tocPendingNodePulse{
  0%,58%,100%{
    opacity:1;
    transform:translateY(-50%) scale(1);
    filter:none;
    border-color:rgba(var(--toc-armed-rgb),.70);
    box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 18px rgba(var(--toc-armed-rgb),.14),0 10px 14px rgba(0,0,0,.04);
  }
  66%{
    opacity:0.26;
    transform:translateY(-50%) scale(0.92);
    filter:brightness(0.92);
    border-color:rgba(var(--toc-armed-rgb),.54);
    box-shadow:0 0 0 1px rgba(255,255,255,.24),0 0 10px rgba(var(--toc-armed-rgb),.10),0 10px 14px rgba(0,0,0,.04);
  }
  74%{
    opacity:1;
    transform:translateY(-50%) scale(1.04);
    filter:none;
    border-color:rgba(var(--toc-armed-rgb),.98);
    box-shadow:0 0 0 1px rgba(255,255,255,.26),0 0 26px rgba(var(--toc-armed-rgb),.26),0 0 18px rgba(var(--toc-armed-rgb),.16),0 10px 14px rgba(0,0,0,.04);
  }
}

@keyframes tocLanternWash{
  0%{opacity:.36}
  100%{opacity:.84}
}

@keyframes tocLanternFlicker{
  0%,72%,100%{opacity:.18;transform:translate3d(0,0,0) scale(1)}
  76%{opacity:.34;transform:translate3d(1px,0,0) scale(1.02)}
  79%{opacity:.14;transform:translate3d(0,0,0) scale(.99)}
  82%{opacity:.40;transform:translate3d(1px,0,0) scale(1.01)}
  86%{opacity:.20;transform:translate3d(0,0,0) scale(1)}
}

/* Wash lives on the whole button surface (behind text).
   Keep the staged node brass via .toc-item--pending::before above. */
.toc-item--pending .toc-item-btn{
  position:relative;
  isolation:isolate;
}

/* Pending node pulse (the left dot becomes unmistakably "armed"). */
.toc-item--pending:not(.toc-item--current):not([aria-current="page"])::before{animation:tocPendingNodePulse 1100ms ease-in-out infinite}

/* Ember flicker layer (brief, occasional flare) beneath the main wash.
   IMPORTANT: keep this on the wash shade (not violet), so the node/underline remain the only violet elements. */
.toc-item--pending .toc-item-btn::before{
  content:'';
  position:absolute;
  top:-10px;
  bottom:-10px;
  left:.92rem;
  right:46%;

  border-radius:999px;

  background:
    radial-gradient(closest-side at 0% 56%, rgba(var(--toc-pending-wash-rgb),.32) 0%, rgba(var(--toc-pending-wash-rgb),0) 74%),
    radial-gradient(closest-side at 12% 56%, rgba(var(--toc-pending-wash-rgb),.20) 0%, rgba(var(--toc-pending-wash-rgb),0) 78%);

  filter:blur(5px);
  opacity:.18;
  animation:tocLanternFlicker 5200ms linear infinite;

  pointer-events:none;
  z-index:0;
}

.toc-item--pending .toc-item-btn::after{
  content:'';
  position:absolute;
  top:-6px;
  bottom:-6px;

  /* Pull the wash closer to the left gutter so it reads as emanating from the brass node. */
  left:1.02rem;
  right:.30rem;

  /* Dreamy lantern: bigger radius + blur to erase "box" edges. */
  border-radius:18px;
  filter:blur(7px);

  background:
    /* Soft lamp shade (light): keep it gentle; the violet is reserved for node + underline. */
    radial-gradient(78% 190% at 0% 56%, rgba(var(--toc-pending-wash-rgb),.12) 0%, rgba(var(--toc-pending-wash-rgb),0) 60%),
    radial-gradient(95% 220% at 10% 56%, rgba(var(--toc-pending-wash-rgb),.16) 0%, rgba(var(--toc-pending-wash-rgb),0) 64%),
    radial-gradient(120% 260% at 68% 56%, rgba(var(--toc-pending-wash-rgb),.08) 0%, rgba(var(--toc-pending-wash-rgb),0) 70%),
    linear-gradient(to right, rgba(255,255,255,.05) 0%, rgba(255,255,255,0) 60%);

  box-shadow:
    0 0 28px rgba(var(--toc-pending-wash-rgb),.14),
    0 0 24px rgba(var(--toc-pending-wash-rgb),.10),
    inset 12px 0 18px -22px rgba(var(--toc-pending-wash-rgb),.22),
    inset 0 -14px 18px -26px rgba(0,0,0,.58);

  animation:tocLanternWash 2500ms ease-in-out infinite alternate;

  pointer-events:none;
  z-index:0;
}

.toc-item--pending .toc-item-btn > *{position:relative;z-index:1}

/* Pending selection: title effect (staged vs confirm).
   Confirm stage uses :disabled because JS disables the button during nav delay. */
.toc-item--pending:not(.toc-item--current):not([aria-current="page"]) .toc-entry-title{
  background-image:linear-gradient(to right,
    rgba(var(--toc-armed-rgb),0),
    rgba(var(--toc-armed-rgb),.62),
    rgba(var(--toc-armed-rgb),0));
  background-repeat:no-repeat;
  background-position:0 calc(100% - .12em);
  background-size:var(--toc-pending-title-underline-w, 44%) 1px;

  text-shadow:
    0 1px 0 rgba(255,255,255,.20),
    0 0 10px rgba(var(--toc-armed-rgb),.12);

  transition:
    background-size 180ms ease,
    text-shadow 180ms ease;
}

.toc-item--pending:not(.toc-item--current):not([aria-current="page"]) .toc-item-btn:disabled .toc-entry-title{
  background-size:var(--toc-confirm-title-underline-w, 100%) 1px;

  text-shadow:
    0 1px 0 rgba(255,255,255,.22),
    0 0 14px rgba(var(--toc-armed-rgb),.22),
    0 0 28px rgba(var(--toc-armed-rgb),.10);
}

/* Kill the old underline indicator (baseline + fill). */
.toc-item--pending .toc-entry-title::before,
.toc-item--pending .toc-entry-title::after{content:none !important;display:none !important}

/* -------------------------------------------------
   ToC dock glyph feedback (cool/white)
   ------------------------------------------------- */

:root{
  --toc-glyph-rest-color:rgba(212,226,246,0.72);

  --toc-glyph-intent-color:rgba(245,248,255,0.94);

  /* Keep glyph shadow tight so the footer slab never reads "washed".
     Intent glow is carried by the socket cradle, not the glyph aura. */
  --toc-glyph-intent-shadow:
    0 1px 0 rgba(0,0,0,0.92),
    0 0 4px rgba(255,255,255,0.10);
}

#navFooter #tocToggle .toc-glyph{
  position:relative;
  display:inline-block;
  z-index:0;

  color:var(--toc-glyph-rest-color, rgba(212,226,246,0.72));

  text-shadow:
    0 1px 0 rgba(0,0,0,0.92);

  transition:
    color 420ms cubic-bezier(0.22, 0.61, 0.36, 1),
    text-shadow 420ms cubic-bezier(0.22, 0.61, 0.36, 1);
}

/* Glow only during motion/drag (not while fully open). */
html.toc-opening #navFooter #tocToggle .toc-glyph,
html.toc-closing #navFooter #tocToggle .toc-glyph,
#navFooter #tocToggle.is-toc-dragging .toc-glyph{
  color:var(--toc-glyph-intent-color);
  text-shadow:var(--toc-glyph-intent-shadow);
}

/* -------------------------------------------------
   Dock glyph aura guard
   ------------------------------------------------- */

/* Never allow glyph aura overlays to paint over the footer slab.
   Any intent glow should live inside the dock cradle cutouts above.

   Exception: allow explicit tap flash windows (is-tap-opening/is-tap-closing) to paint. */
#navFooter #tocToggle:not(.is-tap-opening):not(.is-tap-closing) .toc-glyph::before,
#navFooter #mirrorToggle:not(.is-tap-opening):not(.is-tap-closing) .toc-glyph::before{content:none !important;display:none !important}
